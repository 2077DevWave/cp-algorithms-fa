
<!doctype html>
<html lang="fa" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The goal of this project is to translate the wonderful resource http://e-maxx.ru/algo which provides descriptions of many algorithms and data structures especially popular in field of competitive programming. Moreover we want to improve the collected knowledge by extending the articles and adding new articles to the collection.">
      
      
      
        <link rel="canonical" href="https://cp-algorithm.sideco.ir/data_structures/segment_tree.html">
      
      
        <link rel="prev" href="sqrt_decomposition.html">
      
      
        <link rel="next" href="treap.html">
      
      
        
      
      
        <link rel="alternate" type="application/rss+xml" title="خوراک آراس‌اس" href="../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="خوراک آراساس محتویات به‌روز شده" href="../feed_rss_updated.xml">
      
      <link rel="icon" href="../favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>درخت بازه‌ها - Algorithms for Competitive Programming</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/rtl.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-Y7FJNDTB9C"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-Y7FJNDTB9C",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-Y7FJNDTB9C",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  <script src="../assets/javascripts/toggle-sidebar.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="rtl" data-md-color-scheme="cpalgo" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#segment-tree" class="md-skip">
          پرش به محتویات
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!-- overwrite:
- scroll to top when clicking title
- go to main page when clicking the site title
-->


<header class="md-header" data-md-component="header">
  <script>
    function scrollToTop() {
      document.body.scrollTop = 0; // For Safari
      document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    }
  </script>
  <nav class="md-header__inner md-grid" aria-label="header.title">
    <a href=".." title="Algorithms for Competitive Programming" class="md-header__button md-logo" aria-label="Algorithms for Competitive Programming" data-md-component="logo">
      
  <img src="../favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            <a href=".." title="Algorithms for Competitive Programming" aria-label="Algorithms for Competitive Programming" data-md-component="logo">
              Algorithms for Competitive Programming
            </a>
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            <a href="#" onclick="scrollToTop()">
              
                درخت بازه‌ها
              
            </a>
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="cpalgo" data-md-color-primary="deep-purple" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="جستجو" placeholder="جستجو" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="جستجو">
        
        <button type="reset" class="md-search__icon md-icon" title="بازنشانی" aria-label="بازنشانی" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            راه‌اندازی جستجو
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/2077DevWave/cp-algorithms-fa" title="رفتن به مخزن" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    2077DevWave/cp-algorithms-fa
  </div>
</a>
      </div>
    
      <div class="rss icon">
      <a href="https://cp-algorithm.sideco.ir/feed_rss_created.xml" title="RSS" class="md-content__button md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M0 64c0-17.7 14.3-32 32-32 229.8 0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7 0 64m0 352a64 64 0 1 1 128 0 64 64 0 1 1-128 0m32-256c159.1 0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7 0-32-14.3-32-32s14.3-32 32-32"/></svg>
      </a>
      </div>

    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="هدایت" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Algorithms for Competitive Programming" class="md-nav__button md-logo" aria-label="Algorithms for Competitive Programming" data-md-component="logo">
      
  <img src="../favicon.ico" alt="logo">

    </a>
    Algorithms for Competitive Programming
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/2077DevWave/cp-algorithms-fa" title="رفتن به مخزن" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    2077DevWave/cp-algorithms-fa
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    خانه
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    خانه
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    صفحه اصلی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../navigation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ناوبری
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tags.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    فهرست برچسب‌ها
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contrib.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    چگونه مشارکت کنیم
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code_of_conduct.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    آیین‌نامه رفتاری
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    پیش‌نمایش
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    جبر
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    جبر
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    مبانی
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    مبانی
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/binary-exp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    توان‌رسانی دودویی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/euclid-algorithm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    الگوریتم اقلیدس برای محاسبه بزرگترین مقسوم‌علیه مشترک
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/extended-euclid-algorithm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    الگوریتم اقلیدس تعمیم‌یافته
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/linear-diophantine-equation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    معادلات سیاله خطی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/fibonacci-numbers.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    اعداد فیبوناچی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    اعداد اول
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    اعداد اول
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/sieve-of-eratosthenes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    غربال اراتستن
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/prime-sieve-linear.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    غربال خطی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/primality_tests.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    آزمون‌های اول بودن
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/factorization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تجزیه اعداد صحیح
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    توابع نظریه اعداد
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    توابع نظریه اعداد
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/phi-function.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تابع فی اویلر
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/divisors.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تعداد مقسوم‌علیه‌ها / جمع مقسوم‌علیه‌ها
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    حساب پیمانه‌ای
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    حساب پیمانه‌ای
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/module-inverse.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    وارون پیمانه‌ای
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/linear_congruence_equation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    معادله همنهشتی خطی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/chinese-remainder-theorem.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    قضیه باقیمانده چینی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/garners-algorithm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    الگوریتم Garner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/factorial-modulo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    فاکتوریل به پیمانه p
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/discrete-log.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    لگاریتم گسسته
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/primitive-root.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ریشه اولیه
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/discrete-root.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ریشه گسسته
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/montgomery_multiplication.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ضرب Montgomery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    دستگاه‌های اعداد
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    دستگاه‌های اعداد
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/balanced-ternary.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    سه‌سه‌ای متوازن
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/gray-code.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    کد گِرِی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    متفرقه
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    متفرقه
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/bit-manipulation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    عملیات بیتی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/all-submasks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    شمارش زیرماسک‌های یک بیت‌ماسک
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/big-integer.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    محاسبات با دقت دلخواه
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/fft.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تبدیل سریع فوریه
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/polynomial.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    عملیات روی چندجمله‌ای‌ها و سری‌ها
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/continued-fractions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    کسرهای مسلسل
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/factoring-exp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تجزیه توان
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ساختمان داده‌ها
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    ساختمان داده‌ها
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    مبانی
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    مبانی
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="stack_queue_modification.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    پشته کمینه / صف کمینه
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sparse-table.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    جدول پراکنده
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    درخت‌ها
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    درخت‌ها
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="disjoint_set_union.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ساختار داده اجتماع-جداگانه
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fenwick.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    درخت فن‌ویک
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sqrt_decomposition.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تجزیه رادیکالی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    درخت بازه‌ها
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="segment_tree.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    درخت بازه‌ها
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="فهرست موضوعات">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      فهرست موضوعات
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        ساده‌ترین شکل یه درخت بازه ها
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ساده‌ترین شکل یه درخت بازه ها">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        ساختار درخت بازه ها
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        ساختن درخت
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        کوئری‌های جمع
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        کوئری‌های آپدیت
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        پیاده‌سازی
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        پیاده‌سازی با حافظه بهینه
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        نسخه‌های پیشرفته درخت بازه ها
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="نسخه‌های پیشرفته درخت بازه ها">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        کوئری‌های پیچیده‌تر
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="کوئری‌های پیچیده‌تر">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maximum" class="md-nav__link">
    <span class="md-ellipsis">
      
        پیدا کردن بیشینه (Maximum)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        پیدا کردن بیشینه و تعداد دفعات ظهورش
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        محاسبه بزرگترین مقسوم‌علیه مشترک (ب.م.م) / کوچکترین مضرب مشترک (ک.م.م)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#counting-zero-search-kth" class="md-nav__link">
    <span class="md-ellipsis">
      
        شمارش تعداد صفرها، جستجو برای k-امین صفر
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        جستجوی پیشوندی از آرایه با یک مقدار معین
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        جستجو برای اولین عنصر بزرگتر از یک مقدار معین
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        پیدا کردن زیربازه‌ها با بیشترین مجموع
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        ذخیره کردن کل زیرآرایه‌ها توی هر گره
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ذخیره کردن کل زیرآرایه‌ها توی هر گره">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        پیدا کردن کوچکترین عدد بزرگتر یا مساوی یه عدد مشخص (بدون کوئری تغییر)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        پیدا کردن کوچکترین عدد بزرگتر یا مساوی یک عدد مشخص (با کوئری تغییر)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fractional-cascading" class="md-nav__link">
    <span class="md-ellipsis">
      
        پیدا کردن کوچکترین عدد بزرگتر یا مساوی یک عدد مشخص (شتاب‌دهی با "آبشار کسری" (Fractional Cascading))
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        سایر تغییرات ممکن
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lazy-propagation" class="md-nav__link">
    <span class="md-ellipsis">
      
        به‌روزرسانی‌های بازه‌ای (انتشار با تأخیر یا Lazy Propagation)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="به‌روزرسانی‌های بازه‌ای (انتشار با تأخیر یا Lazy Propagation)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        افزودن در بازه‌ها
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        انتساب در بازه‌ها
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        افزودن در بازه‌ها، کوئری بیشینه
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      
        تعمیم به ابعاد بالاتر
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="تعمیم به ابعاد بالاتر">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      
        درخت بازه ها‌ی ساده‌ی دوبعدی
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      
        فشرده‌سازی درخت بازه ها دوبعدی
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistent" class="md-nav__link">
    <span class="md-ellipsis">
      
        حفظ تاریخچه مقادیر (درخت بازه ها پایدار یا Persistent)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="حفظ تاریخچه مقادیر (درخت بازه ها پایدار یا Persistent)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k-" class="md-nav__link">
    <span class="md-ellipsis">
      
        پیدا کردن k-امین کوچکترین عدد در یک بازه
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      
        درخت بازه ها پویا
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      
        مسائل تمرینی
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="treap.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تریپ (Treap)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sqrt-tree.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    درخت رادیکالی (Sqrt Tree)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="randomized_heap.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    هیپ تصادفی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    پیشرفته
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    پیشرفته
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="deleting_in_log_n.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    حذف از یک ساختمان داده در O(T(n) log n)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    برنامه‌نویسی پویا
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    برنامه‌نویسی پویا
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dynamic_programming/intro-to-dp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مقدمه‌ای بر برنامه‌نویسی پویا
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dynamic_programming/knapsack.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مسئله کوله‌پشتی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    بهینه‌سازی‌های برنامه‌نویسی پویا
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    بهینه‌سازی‌های برنامه‌نویسی پویا
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dynamic_programming/divide-and-conquer-dp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    برنامه‌نویسی پویای تقسیم و غلبه
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dynamic_programming/knuth-optimization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    بهینه‌سازی Knuth
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    مسائل
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    مسائل
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dynamic_programming/profile-dynamics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    برنامه‌نویسی پویا روی پروفایل شکسته. مسئله "پارکت"
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dynamic_programming/zero_matrix.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    یافتن بزرگترین زیرماتریس صفر
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    پردازش رشته
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    پردازش رشته
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    مبانی
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    مبانی
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/string-hashing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    هشینگ رشته
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/rabin-karp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    الگوریتم رابین-کارپ برای تطبیق رشته
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/prefix-function.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تابع پیشوندی - کنوث-موریس-پرت (KMP)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/z-function.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تابع Z
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/suffix-array.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    آرایه پسوندی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/aho_corasick.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    الگوریتم آهو-کوراسیک
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    پیشرفته
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    پیشرفته
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/suffix-tree-ukkonen.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    درخت پسوندی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/suffix-automaton.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    اتوماتای پسوندی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/lyndon_factorization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تجزیه لیندون
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    مسائل
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    مسائل
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/expression_parsing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تجزیه عبارت
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/manacher.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    الگوریتم ماناکر - یافتن تمام زیرپالیندروم‌ها در O(N)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/main_lorentz.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    یافتن تکرارها
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    جبر خطی
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    جبر خطی
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ماتریس‌ها
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    ماتریس‌ها
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linear_algebra/linear-system-gauss.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    گاوس و دستگاه معادلات خطی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linear_algebra/determinant-gauss.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    گاوس و دترمینان
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linear_algebra/determinant-kraut.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kraut و دترمینان
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linear_algebra/rank-matrix.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    رتبه ماتریس
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ترکیبیات
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    ترکیبیات
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    مبانی
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    مبانی
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algebra/factorial-divisors.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    یافتن توان مقسوم‌علیه فاکتوریل
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../combinatorics/binomial-coefficients.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ضرایب دوجمله‌ای
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../combinatorics/catalan-numbers.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    اعداد کاتالان
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    تکنیک‌ها
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    تکنیک‌ها
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../combinatorics/inclusion-exclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    اصل شمول و عدم شمول
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../combinatorics/burnside.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    لم برنساید / قضیه شمارش پولیا
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../combinatorics/stars_and_bars.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ستاره‌ها و خطوط
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../combinatorics/generating_combinations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تولید تمام ترکیب‌های Kتایی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    مسائل
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    مسائل
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../combinatorics/bishops-on-chessboard.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    قرار دادن فیل‌ها در صفحه شطرنج
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../combinatorics/bracket_sequences.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    دنباله‌های پرانتز متوازن
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../combinatorics/counting_labeled_graphs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    شمارش گراف‌های برچسب‌دار
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    روش‌های عددی
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    روش‌های عددی
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    جستجو
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    جستجو
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../num_methods/binary_search.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    جستجوی دودویی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../num_methods/ternary_search.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    جستجوی سه‌سه‌ای
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../num_methods/roots_newton.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    روش نیوتن برای یافتن ریشه‌ها
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../num_methods/simulated_annealing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تبرید شبیه‌سازی‌شده
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    انتگرال‌گیری
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    انتگرال‌گیری
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../num_methods/simpson-integration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    انتگرال‌گیری با فرمول سیمپسون
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    هندسه
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    هندسه
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1" >
        
          
          <label class="md-nav__link" for="__nav_9_1" id="__nav_9_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    عملیات مقدماتی
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    عملیات مقدماتی
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/basic-geometry.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    هندسه پایه
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/segment-to-line.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    یافتن معادله خط یک پاره‌خط
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/lines-intersection.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    نقطه تقاطع خطوط
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/check-segments-intersection.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    بررسی تقاطع دو پاره‌خط
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/segments-intersection.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تقاطع پاره‌خط‌ها
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/circle-line-intersection.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تقاطع دایره و خط
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/circle-circle-intersection.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تقاطع دو دایره
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/tangents-to-two-circles.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مماس‌های مشترک دو دایره
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/length-of-segments-union.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    طول اجتماع پاره‌خط‌ها
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2" >
        
          
          <label class="md-nav__link" for="__nav_9_2" id="__nav_9_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    چندضلعی‌ها
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    چندضلعی‌ها
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/oriented-triangle-area.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مساحت جهت‌دار مثلث
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/area-of-simple-polygon.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مساحت چندضلعی ساده
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/point-in-convex-polygon.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    بررسی تعلق نقاط به چندضلعی محدب در O(log N)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/minkowski.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    جمع مینکوفسکی چندضلعی‌های محدب
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/picks-theorem.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    قضیه پیک - مساحت چندضلعی‌های شبکه‌ای
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/lattice-points.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    نقاط شبکه‌ای چندضلعی غیرشبکه‌ای
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_3" >
        
          
          <label class="md-nav__link" for="__nav_9_3" id="__nav_9_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    پوش محدب
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    پوش محدب
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/convex-hull.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ساخت پوش محدب
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/convex_hull_trick.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ترفند پوش محدب و درخت Li Chao
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4" >
        
          
          <label class="md-nav__link" for="__nav_9_4" id="__nav_9_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    خط جاروب
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    خط جاروب
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/intersecting_segments.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    جستجوی یک جفت پاره‌خط متقاطع
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_5" >
        
          
          <label class="md-nav__link" for="__nav_9_5" id="__nav_9_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    گراف‌های مسطح
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    گراف‌های مسطح
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/planar.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    یافتن وجه‌های یک گراف مسطح
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/point-location.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مکان‌یابی نقطه در O(log N)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_6" >
        
          
          <label class="md-nav__link" for="__nav_9_6" id="__nav_9_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    متفرقه
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    متفرقه
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/nearest_points.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    یافتن نزدیک‌ترین جفت نقاط
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/delaunay.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مثلث‌بندی دلونی و دیاگرام ورونوی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/vertical_decomposition.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تجزیه عمودی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/halfplane-intersection.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تقاطع نیم‌صفحه‌ها - الگوریتم S&amp;I در O(N log N)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/manhattan-distance.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    فاصله منهتن
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    گراف‌ها
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    گراف‌ها
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_1" >
        
          
          <label class="md-nav__link" for="__nav_10_1" id="__nav_10_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    پیمایش گراف
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    پیمایش گراف
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/breadth-first-search.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    جستجوی اول سطح (BFS)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/depth-first-search.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    جستجوی اول عمق (DFS)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_2" >
        
          
          <label class="md-nav__link" for="__nav_10_2" id="__nav_10_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    مؤلفه‌های همبندی، پل‌ها، نقاط مفصلی
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    مؤلفه‌های همبندی، پل‌ها، نقاط مفصلی
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/search-for-connected-components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    یافتن مؤلفه‌های همبندی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/bridge-searching.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    یافتن پل‌ها در O(N+M)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/bridge-searching-online.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    یافتن پل‌ها به صورت آنلاین
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/cutpoints.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    یافتن نقاط مفصلی در O(N+M)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/strongly-connected-components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مؤلفه‌های قویاً همبند و گراف انقباضی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/strong-orientation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    جهت‌دهی قوی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_3" >
        
          
          <label class="md-nav__link" for="__nav_10_3" id="__nav_10_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    کوتاه‌ترین مسیرهای تک‌مبدأ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    کوتاه‌ترین مسیرهای تک‌مبدأ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/dijkstra.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    دایکسترا - یافتن کوتاه‌ترین مسیرها از یک رأس معین
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/dijkstra_sparse.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    دایکسترا روی گراف‌های خلوت
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/bellman_ford.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    بلمن-فورد - یافتن کوتاه‌ترین مسیرها با وزن‌های منفی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/01_bfs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    جستجوی اول سطح صفر و یک (0-1 BFS)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/desopo_pape.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    الگوریتم D'Esopo-Pape
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4" >
        
          
          <label class="md-nav__link" for="__nav_10_4" id="__nav_10_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    کوتاه‌ترین مسیرهای بین تمام زوج‌ها
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    کوتاه‌ترین مسیرهای بین تمام زوج‌ها
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/all-pair-shortest-path-floyd-warshall.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    فلوید-وارشال - یافتن تمام کوتاه‌ترین مسیرها
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/fixed_length_paths.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تعداد مسیرها با طول ثابت / کوتاه‌ترین مسیرها با طول ثابت
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_5" >
        
          
          <label class="md-nav__link" for="__nav_10_5" id="__nav_10_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    درخت‌های پوشا
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    درخت‌های پوشا
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/mst_prim.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    درخت پوشای کمینه - الگوریتم پریم
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/mst_kruskal.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    درخت پوشای کمینه - کروسکال
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/mst_kruskal_with_dsu.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    درخت پوشای کمینه - کروسکال با ساختار داده اجتماع-جداگانه
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/second_best_mst.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    دومین درخت پوشای کمینه بهتر - با استفاده از کروسکال و پایین‌ترین جد مشترک
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/kirchhoff-theorem.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    قضیه کیرشهف
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/pruefer_code.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    کد پروفر
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_6" >
        
          
          <label class="md-nav__link" for="__nav_10_6" id="__nav_10_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    دورها
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    دورها
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/finding-cycle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    بررسی غیرمدور بودن گراف و یافتن دور در O(M)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/finding-negative-cycle-in-graph.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    یافتن دور منفی در گراف
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/euler_path.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مسیر اویلری
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_7" >
        
          
          <label class="md-nav__link" for="__nav_10_7" id="__nav_10_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    پایین‌ترین جد مشترک
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    پایین‌ترین جد مشترک
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/lca.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    پایین‌ترین جد مشترک (LCA)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/lca_binary_lifting.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    پایین‌ترین جد مشترک - پرش دودویی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/lca_farachcoltonbender.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    پایین‌ترین جد مشترک - الگوریتم Farach-Colton و Bender
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/rmq_linear.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    حل RMQ با یافتن LCA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/lca_tarjan.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    پایین‌ترین جد مشترک - الگوریتم آفلاین Tarjan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_8" >
        
          
          <label class="md-nav__link" for="__nav_10_8" id="__nav_10_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    شار و مسائل مرتبط
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    شار و مسائل مرتبط
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/edmonds_karp.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    شار بیشینه - فورد-فالکرسون و ادموندز-کارپ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/push-relabel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    شار بیشینه - الگوریتم Push-relabel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/push-relabel-faster.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    شار بیشینه - الگوریتم بهبودیافته Push-relabel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/dinic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    شار بیشینه - الگوریتم دینیک
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/mpm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    شار بیشینه - الگوریتم MPM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/flow_with_demands.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    شار با تقاضا
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/min_cost_flow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    شار با کمترین هزینه
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/Assignment-problem-min-flow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مسئله تخصیص
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_9" >
        
          
          <label class="md-nav__link" for="__nav_10_9" id="__nav_10_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    تطابق و مسائل مرتبط
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    تطابق و مسائل مرتبط
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/bipartite-check.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    بررسی دوبخشی بودن گراف
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/kuhn_maximum_bipartite_matching.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    الگوریتم کوهن - تطابق بیشینه در گراف دوبخشی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/hungarian-algorithm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    الگوریتم مجارستانی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_10" >
        
          
          <label class="md-nav__link" for="__nav_10_10" id="__nav_10_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    متفرقه
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    متفرقه
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/topological-sort.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مرتب‌سازی توپولوژیک
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/edge_vertex_connectivity.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    همبندی یالی / همبندی رأسی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/tree_painting.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    رنگ‌آمیزی درخت
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/2SAT.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    دو-ارضاپذیری (2-SAT)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/hld.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    تجزیه سنگین-سبک
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    متفرقه
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    متفرقه
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_1" >
        
          
          <label class="md-nav__link" for="__nav_11_1" id="__nav_11_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    دنباله‌ها
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    دنباله‌ها
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sequences/rmq.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مسئله RMQ (پرس‌وجوی کمینه بازه - کوچکترین عنصر در یک بازه)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sequences/longest_increasing_subsequence.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    طولانی‌ترین زیردنباله صعودی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../others/maximum_average_segment.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    جستجوی زیربازه با بیشترین/کمترین مجموع
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sequences/k-th.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    آماره مرتبه K-ام در O(N)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sequences/mex.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مسئله MEX (کمترین عنصر حذف‌شده در یک آرایه)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2" >
        
          
          <label class="md-nav__link" for="__nav_11_2" id="__nav_11_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    نظریه بازی‌ها
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    نظریه بازی‌ها
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../game_theory/games_on_graphs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    بازی‌ها روی گراف‌های دلخواه
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../game_theory/sprague-grundy-nim.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    قضیه اسپراگ-گراندی. نیم (Nim)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3" >
        
          
          <label class="md-nav__link" for="__nav_11_3" id="__nav_11_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    زمان‌بندی‌ها
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    زمان‌بندی‌ها
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../schedules/schedule_one_machine.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    زمان‌بندی کارها روی یک ماشین
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../schedules/schedule_two_machines.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    زمان‌بندی کارها روی دو ماشین
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../schedules/schedule-with-completion-duration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    زمان‌بندی بهینه کارها با توجه به مهلت‌ها و مدت‌زمانشان
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_4" >
        
          
          <label class="md-nav__link" for="__nav_11_4" id="__nav_11_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    متفرقه
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    متفرقه
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../others/tortoise_and_hare.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    الگوریتم لاک‌پشت و خرگوش (تشخیص دور در لیست پیوندی)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../others/josephus_problem.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    مسئله یوسف
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../others/15-puzzle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    بازی پازل ۱۵: وجود راه‌حل
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../others/stern_brocot_tree_farey_sequences.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    درخت اشترن-بروکوت و دنباله‌های فارِی
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  <script type="text/javascript">
window.onload = function() {
	const newIssueURL = "https://github.com/2077DevWave/cp-algorithms-fa/issues/new";
  const issueTitle = "Problem on article " + "\u062f\u0631\u062e\u062a \u0628\u0627\u0632\u0647\u200c\u0647\u0627";
	const issueBody = `
 **Article:** [`+ "\u062f\u0631\u062e\u062a \u0628\u0627\u0632\u0647\u200c\u0647\u0627" + `](${window.location.href})

**Problem:**
<!--
Describe the issue of this article in detail.
-->
`;
  var issue_a = document.getElementById("report_issue_a");
  issue_a.href = `${newIssueURL}?` + `title=${encodeURIComponent(issueTitle)}&` + `body=${encodeURIComponent(issueBody)}`;
}
</script>

<a href="https://github.com/2077DevWave/cp-algorithms-fa/edit/main/src/data_structures/segment_tree.md" title="این صفحه را ویرایش کنید" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg>
</a>
<a id="report_issue_a" href="" title="Report a problem" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14h-2V9h2m0 9h-2v-2h2M1 21h22L12 2z"/></svg>
</a>
<a href="https://github.com/2077DevWave/cp-algorithms-fa/commits/main/src/data_structures/segment_tree.md" title="Page authors" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000"><g><rect fill="none" height="24" width="24"/></g><g><g><g><path d="M12,8.5c-0.91,0-2.75,0.46-2.75,1.38v4.62h1.5V19h2.5v-4.5h1.5V9.88C14.75,8.97,12.91,8.5,12,8.5z"/><path d="M12,2C6.47,2,2,6.47,2,12s4.47,10,10,10s10-4.48,10-10S17.52,2,12,2z M12,20c-4.42,0-8-3.58-8-8s3.58-8,8-8s8,3.58,8,8 S16.42,20,12,20z"/><circle cx="12" cy="6.5" r="1.5"/></g></g></g></svg>
</a>


<!-- Construct the dict of author's contribution percentage -->




  
  
  
    
  

  
  
  
    
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  
    
  

  
  
  
    
  

  
  
  
    
  
    
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  
    
  

  
  
  
    
  

  
  
  
    
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  

  
  
  
    
  
    
  
    
  
    
  

  
  
  
    
  
    
  

  
  
  
    
  



  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  

  
  
  




<!-- Date of last commit -->
<ul class="metadata page-metadata" data-bi-name="page info" lang="en-us" dir="ltr">

  اخرین بروزرسانی:
  <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="12 سپتامبر 2025 15:15:14 UTC">12 سپتامبر 2025</span>&emsp;

<!-- Tags -->

  
  
  
    
  


  
    <a href="../tags.html#tag:fully-translated" class="md-tag">
      Fully Translated
    </a>
  

  
    <a href="https://e-maxx.ru/algo/segment_tree" class="md-tag">
      From: e-maxx.ru
    </a>
  

</ul>


<h1 id="segment-tree">درخت بازه ها (Segment Tree)<a class="headerlink" href="#segment-tree" title="Permanent link">&para;</a></h1>
<p>«درخت بازه ها» یا همون Segment Tree، یه ساختمان داده‌ی باحاله که اطلاعات مربوط به بازه‌های مختلفِ یه آرایه رو به شکل درختی ذخیره می‌کنه. با این ساختار داده می‌تونی خیلی بهینه به کوئری‌های بازه‌ای (Range Queries) روی یه آرایه جواب بدی و در عین حال، اون‌قدر انعطاف‌پذیره که بهت اجازه می‌ده خودِ آرایه رو هم سریع تغییر بدی.</p>
<p>مثلاً می‌تونی جمع عناصر یه بازه‌ی پشت سر هم مثل <span class="arithmatex">$a[l \dots r]$</span> یا کمترین عنصر توی همچین بازه‌ای رو توی زمان <span class="arithmatex">$O(\log n)$</span> پیدا کنی.</p>
<p>تازه بین جواب دادن به این کوئری‌ها، درخت بازه ها بهت اجازه می‌ده که آرایه رو هم دستکاری کنی. مثلاً یه عنصر رو عوض کنی یا حتی کل عناصر یه زیربازه رو تغییر بدی (مثلاً به همه‌ی عناصر <span class="arithmatex">$a[l \dots r]$</span> یه مقدار جدید بدی یا یه عددی رو به همشون اضافه کنی).</p>
<p>خلاصه که درخت بازه ها یه ساختمان داده‌ی خیلی انعطاف‌پذیره و کلی مسئله‌ی مختلف رو می‌شه باهاش حل کرد.</p>
<p>تازه، می‌شه کارهای پیچیده‌تر و کوئری‌های خفن‌تری هم روش پیاده کرد (یه نگاهی به بخش <a href="segment_tree.html#advanced-versions-of-segment-trees">نسخه‌های پیشرفته درخت بازه ها</a> بنداز).</p>
<p>مخصوصاً اینکه درخت بازه ها رو خیلی راحت می‌شه به ابعاد بالاتر هم تعمیم داد.</p>
<p>مثلاً با یه درخت بازه ها‌ی دو‌بعدی می‌تونی به کوئری‌های جمع یا کمینه روی یه زیرمستطیل از یه ماتریس توی زمان <span class="arithmatex">$O(\log^2 n)$</span> جواب بدی.</p>
<p>یکی از ویژگی‌های مهم درخت بازه ها اینه که فقط به حافظه‌ی خطی (Linear Memory) نیاز داره.</p>
<p>یه درخت بازه ا‌ی استاندارد برای کار کردن روی یه آرایه به اندازه‌ی <span class="arithmatex">$n$</span>، به <span class="arithmatex">$4n$</span> تا رأس احتیاج داره.</p>
<h2 id="_1">ساده‌ترین شکل یه درخت بازه ها<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>بیا برای شروع، ساده‌ترین مدل یه درخت بازه ها رو با هم ببینیم.</p>
<p>فرض کن می‌خوایم به کوئری‌های جمع (Sum Queries) به شکل بهینه جواب بدیم.</p>
<p>وظیفه‌ی ما به طور رسمی اینه:</p>
<p>یه آرایه‌ی <span class="arithmatex">$a[0 \dots n-1]$</span> داریم. درخت بازه ها باید بتونه جمع عناصر بین اندیس‌های <span class="arithmatex">$l$</span> و <span class="arithmatex">$r$</span> رو حساب کنه (یعنی <span class="arithmatex">$\sum_{i=l}^r a[i]$</span>) و همزمان بتونه مقدار عناصر آرایه رو هم تغییر بده (یعنی یه چیزی مثل <span class="arithmatex">$a[i] = x$</span>).</p>
<p>نکته‌ی مهم اینه که درخت بازه ها باید بتونه <strong>هر دو</strong> تا کار رو توی زمان <span class="arithmatex">$O(\log n)$</span> انجام بده.</p>
<p>این خودش یه پیشرفت بزرگ نسبت به راه‌حل‌های ساده‌تره.</p>
<p>اگه فقط از یه آرایه‌ی معمولی استفاده کنی، آپدیت کردن عناصر توی <span class="arithmatex">$O(1)$</span> انجام می‌شه، ولی برای حساب کردن هر جمعی به زمان <span class="arithmatex">$O(n)$</span> نیاز داری.</p>
<p>از طرف دیگه، اگه از مجموع‌های پیشوندی (Prefix Sums) استفاده کنی، می‌تونی جمع‌ها رو توی <span class="arithmatex">$O(1)$</span> حساب کنی، ولی اگه بخوای یه عنصر رو آپدیت کنی، باید <span class="arithmatex">$O(n)$</span> تا از مجموع‌های پیشوندی رو تغییر بدی.</p>
<h3 id="_2">ساختار درخت بازه ها<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>می‌تونیم از روش «تقسیم و غلبه» (Divide and Conquer) برای بازه‌های آرایه استفاده کنیم.</p>
<p>اول میایم جمع کل عناصر آرایه، یعنی بازه‌ی <span class="arithmatex">$a[0 \dots n-1]$</span> رو حساب می‌کنیم و یه جا ذخیره‌ش می‌کنیم.</p>
<p>بعد آرایه رو به دو تا نصفه تقسیم می‌کنیم: <span class="arithmatex">$a[0 \dots n/2-1]$</span> و <span class="arithmatex">$a[n/2 \dots n-1]$</span> و جمع هر کدوم از این نصفه‌ها رو هم حساب و ذخیره می‌کنیم.</p>
<p>این کار رو برای هر کدوم از این نصفه‌ها هم تکرار می‌کنیم و اینقدر ادامه می‌دیم تا همه‌ی بازه‌ها به اندازه‌ی ۱ برسن.</p>
<p>می‌تونیم این بازه‌ها رو مثل یه درخت دودویی (Binary Tree) در نظر بگیریم:</p>
<p>ریشه‌ی این درخت، بازه‌ی <span class="arithmatex">$a[0 \dots n-1]$</span>ئه و هر گره (به جز برگ‌ها) دقیقاً دو تا بچه داره.</p>
<p>برای همین هم بهش می‌گن «درخت بازه ها»، هرچند که توی بیشتر پیاده‌سازی‌ها، این درخت رو به صورت صریح نمی‌سازیم (یه نگاهی به بخش <a href="segment_tree.html#implementation">پیاده‌سازی</a> بنداز).</p>
<p>اینجا یه عکس از این درخت بازه ها روی آرایه‌ی <span class="arithmatex">$a = [1, 3, -2, 8, -7]$</span> رو می‌بینی:</p>
<p><img alt="&quot;درخت بازه ها برای مجموع&quot;" src="sum-segment-tree.png" /></p>
<p>از همین توضیحات کوتاه می‌شه فهمید که یه درخت بازه ها فقط به تعداد خطی گره نیاز داره.</p>
<p>سطح اول درخت یه گره (ریشه) داره، سطح دوم دو تا، سطح سوم چهار تا، و همین‌طوری ادامه پیدا می‌کنه تا تعداد گره‌ها به <span class="arithmatex">$n$</span> برسه.</p>
<p>پس تعداد کل گره‌ها رو توی بدترین حالت می‌شه با <span class="arithmatex">$1 + 2 + 4 + \dots + 2^{\lceil\log_2 n\rceil} \lt 2^{\lceil\log_2 n\rceil + 1} \lt 4n$</span> تخمین زد.</p>
<p>یه نکته‌ی جالب اینه که هر وقت <span class="arithmatex">$n$</span> توانی از دو نباشه، همه‌ی سطح‌های درخت کامل پر نمی‌شن.</p>
<p>این رو می‌تونی توی عکس هم ببینی.</p>
<p>فعلاً می‌تونیم این قضیه رو نادیده بگیریم، ولی بعداً موقع پیاده‌سازی برامون مهم می‌شه.</p>
<p>ارتفاع درخت بازه ها <span class="arithmatex">$O(\log n)$</span>ئه، چون وقتی از ریشه به سمت برگ‌ها میایم پایین، اندازه‌ی بازه‌ها تقریباً نصف می‌شه.</p>
<h3 id="_3">ساختن درخت<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>قبل از اینکه درخت رو بسازیم، باید دو تا تصمیم بگیریم:</p>
<ol>
<li>چه <em>مقداری</em> رو توی هر گره درخت بازه ها ذخیره کنیم.</li>
</ol>
<p>مثلاً توی یه درخت بازه ها برای جمع، هر گره، جمع عناصر بازه‌ی خودش <span class="arithmatex">$[l, r]$</span> رو نگه می‌داره.</p>
<ol>
<li>عملیات <em>ادغام</em> (merge) که دو تا گره خواهر و برادر رو با هم یکی می‌کنه.</li>
</ol>
<p>مثلاً توی درخت بازه ها برای جمع، دو تا گره که مربوط به بازه‌های <span class="arithmatex">$a[l_1 \dots r_1]$</span> و <span class="arithmatex">$a[l_2 \dots r_2]$</span> هستن، با جمع کردن مقدارهاشون توی یه گره جدید برای بازه‌ی <span class="arithmatex">$a[l_1 \dots r_2]$</span> ادغام می‌شن.</p>
<p>یادت باشه که یه گره، «برگ» حساب می‌شه اگه بازه‌ش فقط یه مقدار از آرایه‌ی اصلی رو پوشش بده. این گره‌ها توی پایین‌ترین سطح درخت قرار دارن. مقدارشون هم همون عنصر مربوطه یعنی <span class="arithmatex">$a[i]$</span>ئه.</p>
<p>خب، حالا برای ساختن درخت، از پایین‌ترین سطح (برگ‌ها) شروع می‌کنیم و مقدارهاشون رو می‌ذاریم. بعد با استفاده از این مقدارها و تابع <code>merge</code>، می‌تونیم مقدار گره‌های سطح بالاتر رو حساب کنیم.</p>
<p>و همین‌طور این روند رو ادامه می‌دیم تا به ریشه برسیم.</p>
<p>البته توضیح این عملیات به صورت بازگشتی از بالا به پایین، یعنی از ریشه به سمت برگ‌ها، راحت‌تره. تابع ساخت، اگه روی یه گره غیر برگ صدا زده بشه، این کارها رو می‌کنه:</p>
<ol>
<li>
<p>به صورت بازگشتی، مقدارهای دو تا گره بچه‌ش رو می‌سازه.</p>
</li>
<li>
<p>مقدارهای حساب‌شده‌ی بچه‌هاش رو با هم ادغام می‌کنه.</p>
</li>
</ol>
<p>ما ساختن رو از ریشه شروع می‌کنیم و به این ترتیب، کل درخت بازه ها رو می‌تونیم بسازیم.</p>
<p>پیچیدگی زمانی ساخت این درخت <span class="arithmatex">$O(n)$</span> می‌شه، البته به شرطی که عملیات ادغام، زمان ثابت داشته باشه (چون عملیات ادغام <span class="arithmatex">$n$</span> بار صدا زده می‌شه، که دقیقاً برابر با تعداد گره‌های داخلی توی درخته).</p>
<h3 id="_4">کوئری‌های جمع<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>فعلاً می‌خوایم به کوئری‌های جمع جواب بدیم. به عنوان ورودی، دو تا عدد <span class="arithmatex">$l$</span> و <span class="arithmatex">$r$</span> می‌گیریم و باید جمع بازه‌ی <span class="arithmatex">$a[l \dots r]$</span> رو توی زمان <span class="arithmatex">$O(\log n)$</span> حساب کنیم.</p>
<p>برای این کار، درخت بازه ها رو پیمایش می‌کنیم و از جمع‌های از پیش حساب‌شده‌ی بازه‌ها استفاده می‌کنیم.</p>
<p>فرض کن الان توی یه گره هستیم که بازه‌ی <span class="arithmatex">$a[tl \dots tr]$</span> رو پوشش می‌ده.</p>
<p>سه تا حالت ممکنه پیش بیاد.</p>
<p>ساده‌ترین حالت اینه که بازه‌ی کوئری <span class="arithmatex">$a[l \dots r]$</span> دقیقاً با بازه‌ی گره فعلی یکی باشه (یعنی <span class="arithmatex">$a[l \dots r] = a[tl \dots tr]$</span>). توی این حالت کارمون تمومه و می‌تونیم همون جمع از پیش حساب‌شده‌ای که توی گره ذخیره شده رو برگردونیم.</p>
<p>حالت بعدی اینه که بازه‌ی کوئری کاملاً توی محدوده‌ی بچه‌ی چپ یا بچه‌ی راست قرار بگیره.</p>
<p>یادت باشه که بچه‌ی چپ بازه‌ی <span class="arithmatex">$a[tl \dots tm]$</span> و بچه‌ی راست بازه‌ی <span class="arithmatex">$a[tm + 1 \dots tr]$</span> رو با <span class="arithmatex">$tm = (tl + tr) / 2$</span> پوشش می‌دن.</p>
<p>توی این حالت، خیلی راحت می‌ریم سراغ اون بچه‌ای که بازه‌ش، بازه‌ی کوئری ما رو پوشش می‌ده و الگوریتم رو از اونجا ادامه می‌دیم.</p>
<p>و بالاخره حالت آخر، وقتیه که بازه‌ی کوئری با هر دو تا بچه تلاقی داره.</p>
<p>اینجا چاره‌ای نداریم جز اینکه دو تا فراخوانی بازگشتی انجام بدیم، یکی برای هر بچه.</p>
<p>اول می‌ریم سراغ بچه‌ی چپ و یه جواب جزئی برای این گره حساب می‌کنیم (یعنی جمع مقادیر تلاقی بین بازه‌ی کوئری و بازه‌ی بچه‌ی چپ). بعد می‌ریم سراغ بچه‌ی راست و جواب جزئی اون رو هم حساب می‌کنیم و در نهایت این دو تا جواب رو با هم جمع می‌کنیم تا جواب نهایی به دست بیاد.</p>
<p>به عبارت دیگه، چون بچه‌ی چپ بازه‌ی <span class="arithmatex">$a[tl \dots tm]$</span> و بچه‌ی راست بازه‌ی <span class="arithmatex">$a[tm+1 \dots tr]$</span> رو نشون می‌ده، ما کوئری جمع <span class="arithmatex">$a[l \dots tm]$</span> رو با بچه‌ی چپ و کوئری جمع <span class="arithmatex">$a[tm+1 \dots r]$</span> رو با بچه‌ی راست حساب می‌کنیم.</p>
<p>پس پردازش یه کوئری جمع، یه تابع بازگشتیه که یا خودش رو یه بار برای بچه‌ی چپ یا راست صدا می‌زنه (بدون اینکه مرزهای کوئری رو عوض کنه)، یا دو بار، یکی برای چپ و یکی برای راست (که کوئری رو به دو تا زیرکوئری تقسیم می‌کنه).</p>
<p>و بازگشت وقتی تموم می‌شه که مرزهای بازه‌ی کوئری فعلی با مرزهای بازه‌ی گره فعلی یکی بشن. توی اون حالت، جواب، همون مقدار از پیش حساب‌شده‌ی جمع این بازه است که توی درخت ذخیره شده.</p>
<p>به عبارت دیگه، حساب کردن کوئری مثل یه پیمایش توی درخته که توی همه‌ی شاخه‌های لازم پخش می‌شه و از جمع‌های از پیش حساب‌شده‌ی بازه‌ها استفاده می‌کنه.</p>
<p>معلومه که پیمایش رو از ریشه‌ی درخت بازه ها شروع می‌کنیم.</p>
<p>این فرآیند رو توی عکس زیر می‌تونی ببینی.</p>
<p>دوباره از همون آرایه‌ی <span class="arithmatex">$a = [1, 3, -2, 8, -7]$</span> استفاده کردیم و اینجا می‌خوایم جمع <span class="arithmatex">$\sum_{i=2}^4 a[i]$</span> رو حساب کنیم.</p>
<p>گره‌های رنگی، گره‌هایی هستن که بهشون سر می‌زنیم و از مقدارهای از پیش حساب‌شده‌ی گره‌های سبز استفاده می‌کنیم.</p>
<p>این کار در نهایت به ما جواب $ -2 + 1 = -1$ رو می‌ده.</p>
<p><img alt="&quot;پرس‌وجوی درخت بازه ها برای مجموع&quot;" src="sum-segment-tree-query.png" /></p>
<p>چرا پیچیدگی این الگوریتم <span class="arithmatex">$O(\log n)$</span>ئه؟</p>
<p>برای اینکه این رو نشون بدیم، بیا به هر سطح از درخت نگاه کنیم.</p>
<p>معلوم می‌شه که برای هر سطح، ما بیشتر از چهار تا گره رو نمی‌بینیم.</p>
<p>و چون ارتفاع درخت <span class="arithmatex">$O(\log n)$</span>ئه، به همون زمان اجرای دلخواه‌مون می‌رسیم.</p>
<p>می‌تونیم با استقرا نشون بدیم که این گزاره (حداکثر چهار گره در هر سطح) درسته.</p>
<p>توی سطح اول، فقط به یه گره، یعنی ریشه، سر می‌زنیم، پس اینجا کمتر از چهار تا گره رو دیدیم.</p>
<p>حالا بیا یه سطح دلخواه رو در نظر بگیریم.</p>
<p>طبق فرض استقرا، حداکثر چهار تا گره رو توی این سطح می‌بینیم.</p>
<p>اگه حداکثر دو تا گره رو ببینیم، سطح بعدی حداکثر چهار تا گره خواهد داشت. این که واضحه، چون هر گره حداکثر می‌تونه دو تا فراخوانی بازگشتی ایجاد کنه.</p>
<p>پس فرض کنیم که سه یا چهار تا گره رو توی سطح فعلی می‌بینیم.</p>
<p>از بین این گره‌ها، بیا اون وسطی‌ها رو با دقت بیشتری بررسی کنیم.</p>
<p>چون کوئری جمع، جمع یه زیرآرایه‌ی پیوسته رو می‌خواد، می‌دونیم که بازه‌های مربوط به گره‌های وسطی، به طور کامل توسط بازه‌ی کوئری پوشش داده می‌شن.</p>
<p>پس این گره‌ها هیچ فراخوانی بازگشتی‌ای انجام نمی‌دن.</p>
<p>در نتیجه، فقط گره‌های چپ‌ترین و راست‌ترین پتانسیل این رو دارن که فراخوانی بازگشتی انجام بدن.</p>
<p>و اونا هم حداکثر چهار تا فراخوانی بازگشتی ایجاد می‌کنن، پس سطح بعدی هم این گزاره رو برآورده می‌کنه.</p>
<p>می‌تونیم بگیم یه شاخه به مرز چپ کوئری نزدیک می‌شه و شاخه‌ی دوم به مرز راستش.</p>
<p>بنابراین در کل حداکثر <span class="arithmatex">$4 \log n$</span> گره رو می‌بینیم و این همون زمان اجرای <span class="arithmatex">$O(\log n)$</span>ئه.</p>
<p>در نتیجه، کوئری با تقسیم کردن بازه‌ی ورودی به چندتا زیربازه کار می‌کنه که جمع‌هاشون قبلاً توی درخت حساب و ذخیره شده.</p>
<p>و اگه هر وقت بازه‌ی کوئری با بازه‌ی گره یکی شد، تقسیم‌بندی رو متوقف کنیم، فقط به <span class="arithmatex">$O(\log n)$</span> تا از این بازه‌ها نیاز خواهیم داشت و این همون چیزیه که کارایی درخت بازه ها رو نشون می‌ده.</p>
<h3 id="_5">کوئری‌های آپدیت<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>حالا فرض کن می‌خوایم یه عنصر خاص توی آرایه رو تغییر بدیم، مثلاً می‌خوایم <span class="arithmatex">$a[i] = x$</span> رو انجام بدیم.</p>
<p>و باید درخت بازه ها رو جوری بازسازی کنیم که با آرایه‌ی جدید و اصلاح‌شده جور دربیاد.</p>
<p>این کوئری از کوئری جمع ساده‌تره.</p>
<p>هر سطح از یه درخت بازه ها، یه افراز (Partition) از آرایه رو تشکیل می‌ده.</p>
<p>بنابراین یه عنصر <span class="arithmatex">$a[i]$</span> فقط توی یه بازه از هر سطح نقش داره.</p>
<p>در نتیجه، فقط <span class="arithmatex">$O(\log n)$</span> تا گره نیاز به آپدیت دارن.</p>
<p>خیلی راحت می‌شه دید که درخواست آپدیت رو می‌شه با یه تابع بازگشتی پیاده کرد.</p>
<p>این تابع، گره فعلی درخت رو به عنوان پارامتر می‌گیره و به صورت بازگشتی خودش رو روی یکی از دو تا بچه‌ش (اونی که <span class="arithmatex">$a[i]$</span> توی بازه‌ش قرار داره) صدا می‌زنه و بعد از اون، مقدار جمع خودش رو دوباره حساب می‌کنه، دقیقاً مثل کاری که توی تابع ساخت انجام می‌دادیم (یعنی به عنوان جمع دو تا بچه‌ش).</p>
<p>باز هم اینجا یه تصویرسازی با همون آرایه داریم.</p>
<p>اینجا داریم آپدیت <span class="arithmatex">$a[2] = 3$</span> رو انجام می‌دیم.</p>
<p>گره‌های سبز، گره‌هایی هستن که بهشون سر می‌زنیم و آپدیتشون می‌کنیم.</p>
<p><img alt="&quot;به‌روزرسانی درخت بازه ها برای مجموع&quot;" src="sum-segment-tree-update.png" /></p>
<h3 id="implementation">پیاده‌سازی<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h3>
<p>حالا نکته‌ی اصلی اینه که چطوری خودِ درخت بازه ها رو ذخیره کنیم.</p>
<p>البته که می‌تونیم یه ساختار <code>Vertex</code> تعریف کنیم و آبجکت‌هایی بسازیم که مرزهای بازه، جمعش، و اشاره‌گر به بچه‌هاش رو ذخیره کنن.</p>
<p>ولی این کار نیاز به ذخیره‌ی کلی اطلاعات اضافه به شکل اشاره‌گر داره.</p>
<p>ما از یه ترفند ساده استفاده می‌کنیم تا این کار رو با یه <em>ساختار داده‌ی ضمنی</em> (Implicit Data Structure) کارآمدتر کنیم: فقط جمع‌ها رو توی یه آرایه ذخیره می‌کنیم.</p>
<p>(یه روش مشابه برای هیپ‌های دودویی یا Binary Heaps استفاده می‌شه).</p>
<p>جمع ریشه رو توی اندیس ۱، جمع دو تا بچه‌ش رو توی اندیس‌های ۲ و ۳، جمع بچه‌های اونا رو توی اندیس‌های ۴ تا ۷ و همین‌طور الی آخر ذخیره می‌کنیم.</p>
<p>با اندیس‌گذاری از ۱، خیلی راحت می‌شه بچه‌ی چپِ یه گره توی اندیس <span class="arithmatex">$i$</span> رو توی اندیس <span class="arithmatex">$2i$</span> و بچه‌ی راستش رو توی اندیس <span class="arithmatex">$2i + 1$</span> پیدا کرد.</p>
<p>به همین ترتیب، پدرِ یه گره توی اندیس <span class="arithmatex">$i$</span> هم توی <span class="arithmatex">$i/2$</span> (تقسیم صحیح) ذخیره می‌شه.</p>
<p>این کار پیاده‌سازی رو خیلی ساده می‌کنه.</p>
<p>دیگه نیازی نیست ساختار درخت رو توی حافظه نگه داریم.</p>
<p>این ساختار به صورت ضمنی تعریف شده.</p>
<p>ما فقط به یه آرایه احتیاج داریم که شامل جمع همه‌ی بازه‌ها باشه.</p>
<p>همون‌طور که قبلاً گفتیم، حداکثر باید <span class="arithmatex">$4n$</span> تا گره ذخیره کنیم.</p>
<p>ممکنه کمتر باشه، ولی برای راحتی کار، همیشه یه آرایه به اندازه‌ی <span class="arithmatex">$4n$</span> می‌گیریم.</p>
<p>بعضی از خونه‌های آرایه‌ی جمع ممکنه با هیچ گره‌ای توی درخت واقعی مطابقت نداشته باشن، ولی این موضوع پیاده‌سازی رو پیچیده نمی‌کنه.</p>
<p>پس، ما درخت بازه ها رو خیلی ساده به عنوان یه آرایه‌ی <span class="arithmatex">$t[]$</span> با اندازه‌ی چهار برابر اندازه‌ی ورودی <span class="arithmatex">$n$</span> ذخیره می‌کنیم:</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">MAXN</span><span class="p">];</span>
</code></pre></div>
<p>تابع ساخت درخت بازه ها از یه آرایه‌ی داده‌شده‌ی <span class="arithmatex">$a[]$</span> به این صورته:</p>
<p>این یه تابع بازگشتیه با پارامترهای <span class="arithmatex">$a[]$</span> (آرایه‌ی ورودی)، <span class="arithmatex">$v$</span> (اندیس گره فعلی) و مرزهای <span class="arithmatex">$tl$</span> و <span class="arithmatex">$tr$</span> بازه‌ی فعلی.</p>
<p>توی برنامه‌ی اصلی، این تابع با پارامترهای ریشه صدا زده می‌شه: <span class="arithmatex">$v = 1$</span>، <span class="arithmatex">$tl = 0$</span> و <span class="arithmatex">$tr = n - 1$</span>.</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">tl</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">);</span>
<span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">);</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>علاوه بر این، تابع جواب دادن به کوئری‌های جمع هم یه تابع بازگشتیه که به عنوان پارامتر، اطلاعات مربوط به گره/بازه‌ی فعلی (یعنی اندیس <span class="arithmatex">$v$</span> و مرزهای <span class="arithmatex">$tl$</span> و <span class="arithmatex">$tr$</span>) و همچنین اطلاعات مربوط به مرزهای کوئری، یعنی <span class="arithmatex">$l$</span> و <span class="arithmatex">$r$</span> رو می‌گیره.</p>
<p>برای ساده‌تر شدن کد، این تابع همیشه دو تا فراخوانی بازگشتی انجام می‌ده، حتی اگه فقط یکی لازم باشه. توی اون حالت، فراخوانی بازگشتی اضافه <span class="arithmatex">$l &gt; r$</span> خواهد داشت، و این رو می‌شه خیلی راحت با یه شرط اضافی اول تابع تشخیص داد.</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">))</span>
<span class="w">           </span><span class="o">+</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>و در نهایت کوئری آپدیت. این تابع هم اطلاعات مربوط به گره/بازه‌ی فعلی و علاوه بر اون، پارامترهای کوئری آپدیت (یعنی موقعیت عنصر و مقدار جدیدش) رو می‌گیره.</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">new_val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_val</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">tm</span><span class="p">)</span>
<span class="w">            </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_6">پیاده‌سازی با حافظه بهینه<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>بیشتر بچه‌ها از پیاده‌سازی بخش قبل استفاده می‌کنن. اگه به آرایه‌ی <code>t</code> نگاه کنی، می‌بینی که شماره‌گذاری گره‌های درخت رو به ترتیب پیمایش BFS (سطح به سطح) دنبال می‌کنه.</p>
<p>با این پیمایش، بچه‌های گره‌ی <span class="arithmatex">$v$</span> به ترتیب <span class="arithmatex">$2v$</span> و <span class="arithmatex">$2v + 1$</span> هستن.</p>
<p>اما اگه <span class="arithmatex">$n$</span> توانی از دو نباشه، این روش بعضی از اندیس‌ها رو نادیده می‌گیره و بخش‌هایی از آرایه‌ی <code>t</code> بدون استفاده باقی می‌مونن.</p>
<p>مصرف حافظه به <span class="arithmatex">$4n$</span> محدود می‌شه، در حالی که یه درخت بازه ها از آرایه‌ای با <span class="arithmatex">$n$</span> عنصر فقط به <span class="arithmatex">$2n - 1$</span> گره نیاز داره.</p>
<p>با این حال، می‌شه این مصرف رو کم کرد.</p>
<p>ما گره‌های درخت رو به ترتیب پیمایش تور اویلر (Euler Tour Traversal) یا همون پیمایش پیش‌ترتیب (pre-order) دوباره شماره‌گذاری می‌کنیم و همه‌ی این گره‌ها رو کنار هم می‌نویسیم.</p>
<p>بیا به یه گره توی اندیس <span class="arithmatex">$v$</span> نگاه کنیم، و فرض کنیم مسئول بازه‌ی <span class="arithmatex">$[l, r]$</span>ئه و <span class="arithmatex">$mid = \dfrac{l + r}{2}$</span>.</p>
<p>واضحه که بچه‌ی چپ، اندیس <span class="arithmatex">$v + 1$</span> رو خواهد داشت.</p>
<p>بچه‌ی چپ مسئول بازه‌ی <span class="arithmatex">$[l, mid]$</span>ئه، یعنی در مجموع <span class="arithmatex">$2 \times (mid - l + 1) - 1$</span> گره توی زیردرخت بچه‌ی چپ وجود خواهد داشت.</p>
<p>بنابراین می‌تونیم اندیس بچه‌ی راستِ <span class="arithmatex">$v$</span> رو حساب کنیم. اندیسش <span class="arithmatex">$v + 2 \times (mid - l + 1)$</span> خواهد بود.</p>
<p>با این شماره‌گذاری، مصرف حافظه رو به <span class="arithmatex">$2n$</span> کاهش می‌دیم.</p>
<h2 id="_7"><a name="advanced-versions-of-segment-trees"></a>نسخه‌های پیشرفته درخت بازه ها<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>درخت بازه ها یه ساختار داده‌ی خیلی انعطاف‌پذیره و می‌شه اون رو توی جهت‌های مختلف تغییر و گسترش داد.</p>
<p>بیا سعی کنیم اونا رو دسته‌بندی کنیم.</p>
<h3 id="_8">کوئری‌های پیچیده‌تر<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>تغییر دادن درخت بازه ها برای محاسبه‌ی کوئری‌های مختلف (مثلاً پیدا کردن کمینه/بیشینه به جای جمع) می‌تونه خیلی راحت باشه، ولی گاهی هم می‌تونه خیلی غیربدیهی و چالش‌برانگیز باشه.</p>
<h4 id="maximum">پیدا کردن بیشینه (Maximum)<a class="headerlink" href="#maximum" title="Permanent link">&para;</a></h4>
<p>بیا شرط مسئله‌ای که بالا توضیح دادیم رو یه کم تغییر بدیم: به جای کوئری جمع، حالا می‌خوایم کوئری‌های بیشینه رو انجام بدیم.</p>
<p>درخت دقیقاً همون ساختاری رو خواهد داشت که بالا توضیح دادیم.</p>
<p>فقط باید نحوه‌ی محاسبه‌ی <span class="arithmatex">$t[v]$</span> رو توی توابع <code>build</code> و <code>update</code> تغییر بدیم.</p>
<p><span class="arithmatex">$t[v]$</span> حالا بیشینه‌ی بازه‌ی مربوط به خودش رو ذخیره می‌کنه.</p>
<p>و همچنین باید محاسبه‌ی مقدار برگشتی تابع <code>sum</code> رو هم تغییر بدیم (جمع رو با بیشینه جایگزین کنیم).</p>
<p>البته این مسئله رو می‌شه خیلی راحت به محاسبه‌ی کمینه به جای بیشینه هم تغییر داد.</p>
<p>به جای اینکه پیاده‌سازی این مسئله رو نشون بدیم، پیاده‌سازی یه نسخه‌ی پیچیده‌تر از این مسئله رو توی بخش بعدی ارائه می‌دیم.</p>
<h4 id="_9">پیدا کردن بیشینه و تعداد دفعات ظهورش<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<p>در این سوال علاوه بر پیدا کردن بیشینه، باید تعداد دفعاتی که تکرار شده رو هم پیدا کنیم.</p>
<p>برای حل این مسئله، توی هر گره درخت یه جفت عدد (pair) ذخیره می‌کنیم:</p>
<p>علاوه بر بیشینه، تعداد تکرارش رو هم توی بازه‌ی مربوطه ذخیره می‌کنیم.</p>
<p>تعیین اینکه چه جفتی رو توی <span class="arithmatex">$t[v]$</span> ذخیره کنیم، هنوز هم می‌تونه توی زمان ثابت با استفاده از اطلاعات جفت‌های ذخیره شده توی گره‌های بچه انجام بشه.</p>
<p>ترکیب دو تا از این جفت‌ها باید توی یه تابع جداگانه انجام بشه، چون این عملیاتیه که ما هم موقع ساختن درخت، هم موقع جواب دادن به کوئری‌های بیشینه و هم موقع انجام تغییرات، انجامش می‌دیم.</p>
<div class="highlight"><pre><span></span><code><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">first</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">first</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">make_pair</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">second</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_pair</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">tl</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">);</span>
<span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">);</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">get_max</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">make_pair</span><span class="p">(</span><span class="o">-</span><span class="n">INF</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">get_max</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">)),</span><span class="w"> </span>
<span class="w">                   </span><span class="n">get_max</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">new_val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_pair</span><span class="p">(</span><span class="n">new_val</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">tm</span><span class="p">)</span>
<span class="w">            </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_10">محاسبه بزرگترین مقسوم‌علیه مشترک (ب.م.م) / کوچکترین مضرب مشترک (ک.م.م)<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<p>توی این مسئله می‌خوایم ب.م.م (GCD) / ک.م.م (LCM) همه‌ی اعدادِ بازه‌های داده شده از آرایه رو حساب کنیم.</p>
<p>این نوع جالب از درخت بازه ها رو می‌شه دقیقاً به همون روشی که درختای بازه برای کوئری‌های جمع / کمینه / بیشینه رو درآوردیم، حل کرد:</p>
<p>کافیه ب.م.م / ک.م.م بازه‌ی مربوطه رو توی هر گره‌ی درخت ذخیره کنیم.</p>
<p>ترکیب دو تا گره هم می‌تونه با محاسبه‌ی ب.م.م / ک.م.م هر دو گره انجام بشه.</p>
<h4 id="counting-zero-search-kth">شمارش تعداد صفرها و جستجو برای <span class="arithmatex">$k$</span>-امین صفر<a class="headerlink" href="#counting-zero-search-kth" title="Permanent link">&para;</a></h4>
<p>تو این مسئله می‌خوایم تعداد صفرها رو توی یه بازه‌ی مشخص پیدا کنیم و علاوه بر اون، با یه تابع دوم، اندیس <span class="arithmatex">$k$</span>-امین صفر رو پیدا کنیم.</p>
<p>بازم باید مقادیری که توی درخت ذخیره می‌کنیم رو یه کم تغییر بدیم:</p>
<p>این بار تعداد صفرها رو توی هر بازه، توی <span class="arithmatex">$t[]$</span> ذخیره می‌کنیم.</p>
<p>کاملاً واضحه که چطور باید توابع <code>build</code>، <code>update</code> و <code>count_zero</code> رو پیاده‌سازی کنیم؛ می‌تونیم خیلی راحت از ایده‌های مسئله‌ی کوئری جمع استفاده کنیم.</p>
<p>پس بخش اول مسئله رو حل کردیم.</p>
<p>حالا بیا یاد بگیریم چطور مسئله‌ی پیدا کردن <span class="arithmatex">$k$</span>-امین صفر توی آرایه‌ی <span class="arithmatex">$a[]$</span> رو حل کنیم.</p>
<p>برای این کار، از بالای درخت بازه ها میایم پایین، از ریشه شروع می‌کنیم و هر بار به بچه‌ی چپ یا راست حرکت می‌کنیم، بستگی به این داره که کدوم بازه شامل <span class="arithmatex">$k$</span>-امین صفر باشه.</p>
<p>برای اینکه تصمیم بگیریم سراغ کدوم بچه بریم، کافیه به تعداد صفرهای موجود توی بازه‌ی مربوط به گره‌ی چپ نگاه کنیم.</p>
<p>اگه این تعدادِ از پیش حساب‌شده، بزرگتر یا مساوی <span class="arithmatex">$k$</span> باشه، باید بریم سراغ بچه‌ی چپ، وگرنه باید بریم سراغ بچه‌ی راست.</p>
<p>یادت باشه، اگه بچه‌ی راست رو انتخاب کنیم، باید تعداد صفرهای بچه‌ی چپ رو از <span class="arithmatex">$k$</span> کم کنیم.</p>
<p>توی پیاده‌سازی می‌تونیم حالت خاصی که <span class="arithmatex">$a[]$</span> کمتر از <span class="arithmatex">$k$</span> تا صفر داره رو با برگردوندن -1 مدیریت کنیم.</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">find_kth</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">tl</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">find_kth</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">find_kth</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_11">جستجوی پیشوندی از آرایه با یک مقدار معین<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<p>وظیفه اینطوریه:</p>
<p>برای یه مقدار داده شده‌ی <span class="arithmatex">$x$</span>، باید به سرعت کوچکترین اندیس <span class="arithmatex">$i$</span> رو پیدا کنیم به طوری که جمع <span class="arithmatex">$i$</span> عنصر اول آرایه‌ی <span class="arithmatex">$a[]$</span> بزرگتر یا مساوی <span class="arithmatex">$x$</span> باشه (با فرض اینکه آرایه‌ی <span class="arithmatex">$a[]$</span> فقط مقادیر غیرمنفی داره).</p>
<p>این کار رو می‌شه با استفاده از جستجوی دودویی (Binary Search) و محاسبه‌ی مجموع پیشوندها با درخت بازه ها حل کرد.</p>
<p>ولی این کار یه راه حل <span class="arithmatex">$O(\log^2 n)$</span> به ما می‌ده.</p>
<p>به جاش می‌تونیم از همون ایده‌ی بخش قبلی استفاده کنیم و موقعیت رو با پایین رفتن توی درخت پیدا کنیم:</p>
<p>هر بار به چپ یا راست حرکت می‌کنیم، بستگی به جمع بچه‌ی چپ داره.</p>
<p>اینطوری جواب رو توی زمان <span class="arithmatex">$O(\log n)$</span> پیدا می‌کنیم.</p>
<h4 id="_12">جستجو برای اولین عنصر بزرگتر از یک مقدار معین<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p>وظیفه اینطوریه:</p>
<p>برای یه مقدار داده شده‌ی <span class="arithmatex">$x$</span> و یه بازه‌ی <span class="arithmatex">$a[l \dots r]$</span>، کوچکترین <span class="arithmatex">$i$</span> رو توی بازه‌ی <span class="arithmatex">$a[l \dots r]$</span> پیدا کن، طوری که <span class="arithmatex">$a[i]$</span> بزرگتر از <span class="arithmatex">$x$</span> باشه.</p>
<p>این کار رو می‌شه با استفاده از جستجوی دودویی روی کوئری‌های بیشینه‌ی پیشوند با درخت بازه ها حل کرد.</p>
<p>ولی این کار یه راه حل <span class="arithmatex">$O(\log^2 n)$</span> به ما می‌ده.</p>
<p>به جاش، می‌تونیم از همون ایده‌ی بخش‌های قبلی استفاده کنیم و موقعیت رو با پایین رفتن توی درخت پیدا کنیم:</p>
<p>هر بار به چپ یا راست حرکت می‌کنیم، بستگی به مقدار بیشینه‌ی بچه‌ی چپ داره.</p>
<p>اینطوری جواب رو توی زمان <span class="arithmatex">$O(\log n)$</span> پیدا می‌کنیم.</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">get_first</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">tl</span><span class="p">;</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">tr</span><span class="o">-</span><span class="n">tl</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_first</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">left</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">left</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">get_first</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_13">پیدا کردن زیربازه‌ها با بیشترین مجموع<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<p>اینجا باز هم برای هر کوئری یه بازه‌ی <span class="arithmatex">$a[l \dots r]$</span> می‌گیریم، این بار باید یه زیربازه <span class="arithmatex">$a[l^\prime \dots r^\prime]$</span> پیدا کنیم طوری که <span class="arithmatex">$l \le l^\prime$</span> و <span class="arithmatex">$r^\prime \le r$</span> باشه و جمع عناصر این بازه بیشترین مقدار ممکن باشه.</p>
<p>مثل قبل، می‌خوایم بتونیم عناصر جداگانه‌ی آرایه رو هم تغییر بدیم.</p>
<p>عناصر آرایه می‌تونن منفی باشن و زیربازه‌ی بهینه می‌تونه خالی باشه (مثلاً اگه همه‌ی عناصر منفی باشن).</p>
<p>این مسئله یه استفاده‌ی غیربدیهی از درخت بازه ها‌ست.</p>
<p>این بار چهار تا مقدار برای هر گره ذخیره می‌کنیم:</p>
<p>جمع بازه، بیشترین جمع پیشوندی، بیشترین جمع پسوندی، و جمع زیربازه‌ی بیشینه توی اون بازه.</p>
<p>به عبارت دیگه، برای هر بازه از درخت بازه ها، جواب از قبل حساب شده و همچنین جواب‌ها برای بازه‌هایی که با مرزهای چپ و راست بازه تماس دارن هم حساب شده.</p>
<p>چطور درختی با چنین داده‌هایی بسازیم؟</p>
<p>بازم این رو به صورت بازگشتی حساب می‌کنیم:</p>
<p>اول هر چهار تا مقدار رو برای بچه‌های چپ و راست حساب می‌کنیم، و بعد اونا رو با هم ترکیب می‌کنیم تا چهار تا مقدار برای گره فعلی به دست بیاد.</p>
<p>یادت باشه که جواب برای گره فعلی یکی از این موارد زیره:</p>
<ul>
<li>جواب بچه‌ی چپ، که یعنی زیربازه‌ی بهینه کاملاً توی بازه‌ی بچه‌ی چپ قرار داره.</li>
<li>جواب بچه‌ی راست، که یعنی زیربازه‌ی بهینه کاملاً توی بازه‌ی بچه‌ی راست قرار داره.</li>
<li>جمع بیشترین جمع پسوندی بچه‌ی چپ و بیشترین جمع پیشوندی بچه‌ی راست، که یعنی زیربازه‌ی بهینه با هر دو تا بچه تلاقی داره.</li>
</ul>
<p>پس جواب برای گره فعلی، بیشینه‌ی این سه تا مقداره.</p>
<p>محاسبه‌ی بیشترین جمع پیشوندی/پسوندی حتی ساده‌تره.</p>
<p>اینجا پیاده‌سازی تابع <code>combine</code> رو می‌بینی، که فقط داده‌ها رو از بچه‌ی چپ و راست می‌گیره و داده‌های گره فعلی رو برمی‌گردونه.</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">data</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="n">pref</span><span class="p">,</span><span class="w"> </span><span class="n">suff</span><span class="p">,</span><span class="w"> </span><span class="n">ans</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">data</span><span class="w"> </span><span class="nf">combine</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">sum</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">pref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">pref</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">pref</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">suff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">suff</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">suff</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">ans</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ans</span><span class="p">),</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">suff</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">pref</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>با استفاده از تابع <code>combine</code>، ساختن درخت بازه ها آسونه.</p>
<p>می‌تونیم اون رو دقیقاً به همون روشی که توی پیاده‌سازی‌های قبلی انجام دادیم، پیاده‌سازی کنیم.</p>
<p>برای مقداردهی اولیه‌ی برگ‌ها، یه تابع کمکی <code>make_data</code> هم درست می‌کنیم که یه شیء <code>data</code> حاوی اطلاعات یه مقدار واحد رو برمی‌گردونه.</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="w"> </span><span class="nf">make_data</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">pref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">suff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_data</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">tl</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">);</span>
<span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">);</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">new_val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_data</span><span class="p">(</span><span class="n">new_val</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">tm</span><span class="p">)</span>
<span class="w">            </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>فقط مونده که چطوری به یه کوئری جواب بدیم.</p>
<p>برای جواب دادن بهش، مثل قبل توی درخت پایین می‌ریم، کوئری رو به چندتا زیربازه که با بازه‌های درخت بازه ها منطبق هستن، می‌شکنیم و جواب‌های اون‌ها رو با هم ترکیب می‌کنیم تا جواب نهایی کوئری به دست بیاد.</p>
<p>پس باید واضح باشه که کار دقیقاً مثل درخت بازه ها‌ی ساده‌ست، اما به جای جمع / کمینه‌سازی / بیشینه‌سازی مقادیر، از تابع <code>combine</code> استفاده می‌کنیم.</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">make_data</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">)),</span><span class="w"> </span>
<span class="w">                   </span><span class="n">query</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_14"><a name="saving-the-entire-subarrays-in-each-vertex"></a>ذخیره کردن کل زیرآرایه‌ها توی هر گره<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p>این یه بخش جداست که با بقیه‌ی چیزایی که گفتیم فرق داره. اینجا دیگه توی هر گره از درخت بازه ها، اطلاعات مربوط به بازه رو به شکل فشرده (مثلاً فقط جمع، کمینه، بیشینه و ...) ذخیره نمی‌کنیم، بلکه خودِ کل عنصرهای اون بازه رو نگه می‌داریم.</p>
<p>بنابراین ریشه‌ی درخت بازه ها کل عنصرهای آرایه رو ذخیره می‌کنه، بچه‌ی چپش نیمه‌ی اول آرایه رو، بچه‌ی راست نیمه‌ی دوم رو، و همین‌طور الی آخر.</p>
<p>توی ساده‌ترین کاربرد این تکنیک، ما عناصر رو به صورت مرتب شده ذخیره می‌کنیم.</p>
<p>توی نسخه‌های پیچیده‌تر، عناصر توی لیست ذخیره نمی‌شن، بلکه توی ساختارهای داده‌ی پیشرفته‌تر (مثل set، map و ...) ذخیره می‌شن.</p>
<p>اما همه‌ی این روش‌ها یه عامل مشترک دارن، و اون اینه که هر گره به حافظه‌ی خطی (یعنی متناسب با طول بازه‌ی مربوط بهش) نیاز داره.</p>
<p>اولین سوال طبیعی موقع بررسی این نوع درخت‌های بازه، در مورد مصرف حافظه‌ست.</p>
<p>شاید به نظر بیاد که این کار حافظه‌ی <span class="arithmatex">$O(n^2)$</span> می‌خواد، اما معلوم می‌شه که کل درخت فقط به حافظه‌ی <span class="arithmatex">$O(n \log n)$</span> نیاز خواهد داشت.</p>
<p>چرا اینطوریه؟</p>
<p>خیلی ساده، چون هر عنصر از آرایه توی <span class="arithmatex">$O(\log n)$</span> تا بازه قرار می‌گیره (یادت باشه ارتفاع درخت <span class="arithmatex">$O(\log n)$</span>ئه).</p>
<p>پس با وجود اینکه این مدل درخت بازه ها به نظر اسراف‌کارانه میاد، فقط یه کم بیشتر از درخت بازه ها‌ی معمولی حافظه مصرف می‌کنه.</p>
<p>چندتا کاربرد معمول این ساختار داده رو در ادامه توضیح می‌دیم.</p>
<p>بد نیست به شباهت این درخت‌های بازه با ساختارهای داده‌ی دو بعدی هم اشاره کنیم (در واقع این یه ساختار داده‌ی دو بعدی‌ایه، ولی با قابلیت‌های نسبتاً محدود).</p>
<h4 id="_15">پیدا کردن کوچکترین عدد بزرگتر یا مساوی یه عدد مشخص (بدون کوئری تغییر)<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h4>
<p>می‌خوایم به کوئری‌هایی از این فرم جواب بدیم:</p>
<p>برای سه تا عدد داده شده <span class="arithmatex">$(l, r, x)$</span> باید کوچکترین عدد توی بازه‌ی <span class="arithmatex">$a[l \dots r]$</span> رو که بزرگتر یا مساوی <span class="arithmatex">$x$</span>ئه، پیدا کنیم.</p>
<p>یه درخت بازه ها می‌سازیم.</p>
<p>توی هر گره، یه لیست مرتب شده از همه‌ی اعدادی که توی بازه‌ی مربوطه ظاهر می‌شن رو ذخیره می‌کنیم، همون‌طور که بالا توضیح دادیم.</p>
<p>چطور می‌شه چنین درخت بازه ها‌ای رو بهینه‌ترین شکل ممکن ساخت؟</p>
<p>مثل همیشه به این مسئله به صورت بازگشتی نگاه می‌کنیم: فرض کن لیست‌های بچه‌های چپ و راست از قبل ساخته شدن و ما می‌خوایم لیست رو برای گره فعلی بسازیم.</p>
<p>از این دیدگاه، عملیات الان خیلی واضحه و می‌تونه توی زمان خطی انجام بشه:</p>
<p>فقط باید دو تا لیست مرتب شده رو توی یه لیست ادغام کنیم، که این کار رو می‌شه با پیمایش اونا با استفاده از دو تا اشاره‌گر انجام داد.</p>
<p>STL سی‌پلاس‌پلاس از قبل یه پیاده‌سازی از این الگوریتم داره.</p>
<p>به خاطر این ساختار درخت بازه ها و شباهتش به الگوریتم مرتب‌سازی ادغامی (Merge Sort)، این ساختار داده اغلب "درخت مرتب‌سازی ادغامی" (Merge Sort Tree) هم نامیده می‌شه.</p>
<div class="highlight"><pre><span></span><code><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">tl</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">);</span>
<span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">);</span>
<span class="w">        </span><span class="n">merge</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">].</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">].</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="n">end</span><span class="p">(),</span>
<span class="w">              </span><span class="n">back_inserter</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>ما از قبل می‌دونیم که درخت بازه ها‌ای که به این روش ساخته بشه به حافظه‌ی <span class="arithmatex">$O(n \log n)$</span> نیاز خواهد داشت.</p>
<p>و به لطف این پیاده‌سازی، ساختنش هم <span class="arithmatex">$O(n \log n)$</span> زمان می‌بره، چون هر لیست در زمان خطی نسبت به اندازه‌ش ساخته می‌شه.</p>
<p>حالا بیا به جواب دادن کوئری فکر کنیم.</p>
<p>ما مثل درخت بازه ها‌ی معمولی توی درخت پایین می‌ریم و بازه‌ی خودمون <span class="arithmatex">$a[l \dots r]$</span> رو به چندتا زیربازه می‌شکنیم (حداکثر به <span class="arithmatex">$O(\log n)$</span> تا تیکه).</p>
<p>واضحه که جواب کل، کمینه‌ی هر کدوم از زیرکوئری‌هاست.</p>
<p>بنابراین الان فقط باید بفهمیم که چطوری به یه کوئری توی یکی از این زیربازه‌ها که با بعضی از گره‌های درخت مطابقت داره، جواب بدیم.</p>
<p>ما توی یکی از گره‌های درخت بازه ها هستیم و می‌خوایم جواب کوئری رو حساب کنیم، یعنی کوچکترین عدد بزرگتر یا مساوی عدد داده شده‌ی <span class="arithmatex">$x$</span> رو پیدا کنیم.</p>
<p>از اونجایی که گره شامل یه لیست مرتب شده از عناصر هست، می‌تونیم خیلی راحت یه جستجوی دودویی (Binary Search) توی این لیست انجام بدیم و اولین عدد بزرگتر یا مساوی <span class="arithmatex">$x$</span> رو برگردونیم.</p>
<p>بنابراین جواب به کوئری توی یه بازه از درخت <span class="arithmatex">$O(\log n)$</span> زمان می‌بره، و کل کوئری توی <span class="arithmatex">$O(\log^2 n)$</span> پردازش می‌شه.</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">INF</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lower_bound</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">end</span><span class="p">())</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">pos</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">INF</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">),</span><span class="w"> </span><span class="n">x</span><span class="p">),</span><span class="w"> </span>
<span class="w">               </span><span class="n">query</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<p>ثابت <code>INF</code> برابر با یه عدد خیلی بزرگه که از همه‌ی اعداد آرایه بزرگتره.</p>
<p>استفاده ازش به این معنیه که هیچ عدد بزرگتر یا مساوی <span class="arithmatex">$x$</span> توی بازه وجود نداره.</p>
<p>یعنی "توی این بازه جوابی پیدا نشد".</p>
<h4 id="_16">پیدا کردن کوچکترین عدد بزرگتر یا مساوی یک عدد مشخص (با کوئری تغییر)<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h4>
<p>روش قبلی یه نقطه ضعف داشت، نمی‌شد بین جواب دادن به کوئری‌ها، آرایه رو تغییر داد.</p>
<p>حالا می‌خوایم دقیقاً همین کار رو بکنیم: یه کوئری تغییر، انتساب <span class="arithmatex">$a[i] = y$</span> رو انجام خواهد داد.</p>
<p>راه حل شبیه راه حل مسئله‌ی قبلیه، اما به جای لیست‌ها توی هر گره‌ی درخت بازه ها، یه لیست متعادل (Balanced List) مثل درخت دودویی جستجوی متوازن ذخیره می‌کنیم که بهت اجازه می‌ده به سرعت اعداد رو جستجو کنی، اعداد رو حذف کنی و اعداد جدید رو درج کنی.</p>
<p>چون آرایه می‌تونه یه عدد رو چند بار داشته باشه، بهترین انتخاب ساختار داده، <code>multiset</code>ئه.</p>
<p>ساخت چنین درخت بازه ها‌ای تقریباً به همون روشی که توی مسئله‌ی قبلی انجام شد، انجام می‌شه، فقط الان باید <code>multiset</code>ها رو با هم ترکیب کنیم نه لیست‌های مرتب شده.</p>
<p>این کار باعث می‌شه زمان ساخت <span class="arithmatex">$O(n \log^2 n)$</span> بشه (به طور کلی ادغام دو تا درخت قرمز-سیاه رو می‌شه توی زمان خطی انجام داد، ولی STL سی‌پلاس‌پلاس این پیچیدگی زمانی رو تضمین نمی‌کنه).</p>
<p>تابع <code>query</code> هم تقریباً معادل قبلیه، فقط الان باید تابع <code>lower_bound</code> از <code>multiset</code> صدا زده بشه (تابع <code>std::lower_bound</code> فقط اگه با تکرارگرهای با دسترسی تصادفی (random access iterators) استفاده بشه توی زمان <span class="arithmatex">$O(\log n)$</span> کار می‌کنه).</p>
<p>در نهایت، درخواست تغییر.</p>
<p>برای پردازشش، باید توی درخت پایین بریم و همه‌ی <code>multiset</code>های بازه‌های مربوطه که عنصر تحت تأثیر رو دارن، تغییر بدیم.</p>
<p>ما خیلی راحت مقدار قدیمی این عنصر رو حذف می‌کنیم (اما فقط یه دونه ازش) و مقدار جدید رو درج می‌کنیم.</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">new_val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">erase</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">find</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">pos</span><span class="p">]));</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">insert</span><span class="p">(</span><span class="n">new_val</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">tm</span><span class="p">)</span>
<span class="w">            </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">a</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_val</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>پردازش این درخواست تغییر هم <span class="arithmatex">$O(\log^2 n)$</span> زمان می‌بره.</p>
<h4 id="fractional-cascading">پیدا کردن کوچکترین عدد بزرگتر یا مساوی یک عدد مشخص (شتاب‌دهی با "آبشار کسری" (Fractional Cascading))<a class="headerlink" href="#fractional-cascading" title="Permanent link">&para;</a></h4>
<p>ما همون مسئله‌ی قبلی رو داریم، می‌خوایم کوچکترین عدد بزرگتر یا مساوی <span class="arithmatex">$x$</span> رو توی یه بازه پیدا کنیم، اما این بار توی زمان <span class="arithmatex">$O(\log n)$</span>.</p>
<p>ما پیچیدگی زمانی رو با استفاده از تکنیک "آبشار کسری" بهبود می‌دیم.</p>
<p>آبشار کسری یه تکنیک ساده‌ست که بهت اجازه می‌ده زمان اجرای چندین جستجوی دودویی که همزمان انجام می‌شن رو بهبود بدی.</p>
<p>روش قبلی ما برای کوئری جستجو این بود که کار رو به چندتا زیرمسئله تقسیم می‌کردیم که هر کدوم با یه جستجوی دودویی حل می‌شدن.</p>
<p>آبشار کسری بهت اجازه می‌ده همه‌ی این جستجوهای دودویی رو با یه جستجوی واحد جایگزین کنی.</p>
<p>ساده‌ترین و واضح‌ترین مثال از آبشار کسری مسئله‌ی زیره:</p>
<p><span class="arithmatex">$k$</span> تا لیست مرتب شده از اعداد داریم و باید توی هر لیست، اولین عدد بزرگتر یا مساوی با عدد داده شده رو پیدا کنیم.</p>
<p>به جای اینکه برای هر لیست یه جستجوی دودویی انجام بدیم، می‌تونیم همه‌ی لیست‌ها رو توی یه لیست بزرگ مرتب شده ادغام کنیم.</p>
<p>علاوه بر این، برای هر عنصر <span class="arithmatex">$y$</span> یه لیست از نتایج جستجوی <span class="arithmatex">$y$</span> توی هر کدوم از <span class="arithmatex">$k$</span> تا لیست رو ذخیره می‌کنیم.</p>
<p>بنابراین اگه بخوایم کوچکترین عدد بزرگتر یا مساوی <span class="arithmatex">$x$</span> رو پیدا کنیم، فقط باید یه جستجوی دودویی واحد انجام بدیم و از لیست اندیس‌ها می‌تونیم کوچکترین عدد رو توی هر لیست تعیین کنیم.</p>
<p>این روش اما به <span class="arithmatex">$O(n \cdot k)$</span> حافظه نیاز داره (<span class="arithmatex">$n$</span> طول لیست‌های ترکیبی‌ایه)، که می‌تونه خیلی ناکارآمد باشه.</p>
<p>آبشار کسری این پیچیدگی حافظه رو با ایجاد <span class="arithmatex">$k$</span> تا لیست جدید از <span class="arithmatex">$k$</span> تا لیست ورودی، به حافظه‌ی <span class="arithmatex">$O(n)$</span> کاهش می‌ده، که توی اون هر لیست، شامل لیست مربوطه و علاوه بر اون هر عنصر دوم از لیست جدید بعدی می‌شه.</p>
<p>با استفاده از این ساختار، فقط لازمه دو تا اندیس ذخیره بشه، اندیس عنصر توی لیست اصلی و اندیس عنصر توی لیست جدید بعدی.</p>
<p>بنابراین این روش فقط از حافظه‌ی <span class="arithmatex">$O(n)$</span> استفاده می‌کنه و هنوز هم می‌تونه به کوئری‌ها با استفاده از یه جستجوی دودویی واحد جواب بده.</p>
<p>اما برای کاربرد ما، به قدرت کامل آبشار کسری نیازی نداریم.</p>
<p>توی درخت بازه ها‌ی ما، یه گره شامل لیست مرتب شده از همه‌ی عناصریه که توی زیردرخت‌های چپ یا راستش وجود دارن (مثل درخت مرتب‌سازی ادغامی).</p>
<p>علاوه بر این لیست مرتب شده، برای هر عنصر دو تا موقعیت ذخیره می‌کنیم.</p>
<p>برای یه عنصر <span class="arithmatex">$y$</span>، کوچکترین اندیس <span class="arithmatex">$i$</span> رو ذخیره می‌کنیم، طوری که عنصر <span class="arithmatex">$i$</span>-ام توی لیست مرتب شده‌ی بچه‌ی چپ بزرگتر یا مساوی <span class="arithmatex">$y$</span> باشه.</p>
<p>و کوچکترین اندیس <span class="arithmatex">$j$</span> رو ذخیره می‌کنیم، طوری که عنصر <span class="arithmatex">$j$</span>-ام توی لیست مرتب شده‌ی بچه‌ی راست بزرگتر یا مساوی <span class="arithmatex">$y$</span> باشه.</p>
<p>این مقادیر رو می‌شه به صورت موازی با مرحله‌ی ادغام موقع ساختن درخت حساب کرد.</p>
<p>این کار چطوری کوئری‌ها رو سریع‌تر می‌کنه؟</p>
<p>یادت باشه، توی راه حل عادی ما توی هر گره یه جستجوی دودویی انجام می‌دادیم.</p>
<p>اما با این تغییر، می‌تونیم از همشون به جز یکی خلاص بشیم.</p>
<p>برای جواب دادن به یه کوئری، ما خیلی راحت یه جستجوی دودویی توی گره‌ی ریشه انجام می‌دیم.</p>
<p>این به ما کوچکترین عنصر <span class="arithmatex">$y \ge x$</span> رو توی کل آرایه می‌ده، اما دو تا موقعیت هم بهمون می‌ده.</p>
<p>اندیس کوچکترین عنصر بزرگتر یا مساوی <span class="arithmatex">$x$</span> توی زیردرخت چپ، و اندیس کوچکترین عنصر <span class="arithmatex">$y$</span> توی زیردرخت راست. یادت باشه که <span class="arithmatex">$\ge y$</span> همون <span class="arithmatex">$\ge x$</span>ئه، چون آرایه‌ی ما هیچ عنصری بین <span class="arithmatex">$x$</span> و <span class="arithmatex">$y$</span> نداره.</p>
<p>توی راه حل عادی درخت مرتب‌سازی ادغامی، ما این اندیس‌ها رو از طریق جستجوی دودویی حساب می‌کردیم، اما با کمک مقادیر از پیش حساب شده می‌تونیم اونا رو توی <span class="arithmatex">$O(1)$</span> پیدا کنیم.</p>
<p>و می‌تونیم این کار رو تکرار کنیم تا زمانی که همه‌ی گره‌هایی که بازه‌ی کوئری ما رو پوشش می‌دن، ببینیم.</p>
<p>خلاصه، مثل معمول موقع یه کوئری به <span class="arithmatex">$O(\log n)$</span> گره سر می‌زنیم. توی گره‌ی ریشه یه جستجوی دودویی انجام می‌دیم، و توی همه‌ی گره‌های دیگه فقط کار ثابت انجام می‌دیم.</p>
<p>این یعنی پیچیدگی جواب دادن به یه کوئری <span class="arithmatex">$O(\log n)$</span> می‌شه.</p>
<p>اما یادت باشه که این کار سه برابر بیشتر از یه درخت مرتب‌سازی ادغامی عادی حافظه مصرف می‌کنه، که خود اون هم از قبل حافظه‌ی زیادی (<span class="arithmatex">$O(n \log n)$</span>) مصرف می‌کنه.</p>
<p>اعمال این تکنیک به مسئله‌ای که به هیچ کوئری تغییری نیاز نداره، ساده‌ست.</p>
<p>دو تا موقعیت فقط اعداد صحیح هستن و به راحتی با شمردن موقع ادغام دو تا دنباله‌ی مرتب شده قابل محاسبه‌ان.</p>
<p>هنوز هم می‌شه اجازه داد که کوئری‌های تغییر انجام بشن، اما این کار کل کد رو پیچیده می‌کنه.</p>
<p>به جای اعداد صحیح، باید آرایه‌ی مرتب شده رو به صورت <code>multiset</code> ذخیره کنی، و به جای اندیس‌ها باید تکرارگرها (iterators) رو ذخیره کنی.</p>
<p>و باید خیلی با دقت کار کنی تا موقع یه کوئری تغییر، تکرارگرهای صحیح رو زیاد یا کم کنی.</p>
<h4 id="_17">سایر تغییرات ممکن<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h4>
<p>این تکنیک یه کلاس کاملاً جدید از کاربردهای ممکن رو نشون می‌ده.</p>
<p>به جای ذخیره کردن یه <code>vector</code> یا یه <code>multiset</code> توی هر گره، می‌شه از ساختارهای داده‌ی دیگه‌ای استفاده کرد:</p>
<p>درخت‌های بازه‌ی دیگه (که تا حدودی توی بخش <a href="segment_tree.html#generalization-to-higher-dimensions">تعمیم به ابعاد بالاتر</a> بحث شده)، درخت‌های فن‌ویک (Fenwick Trees)، درختان کارتزین (Cartesian Trees) و غیره.</p>
<h3 id="lazy-propagation">به‌روزرسانی‌های بازه‌ای (انتشار با تأخیر یا Lazy Propagation)<a class="headerlink" href="#lazy-propagation" title="Permanent link">&para;</a></h3>
<p>همه‌ی مسائلی که توی بخش‌های قبل دیدیم، کوئری‌های تغییری رو بررسی کردن که هر بار فقط یه عنصر از آرایه رو تحت تأثیر قرار می‌دادن.</p>
<p>اما درخت بازه ها این امکان رو می‌ده که کوئری‌های تغییر رو روی یه بازه‌ی کامل از عناصر پشت سر هم اعمال کنیم و کوئری رو توی همون زمان <span class="arithmatex">$O(\log n)$</span> انجام بدیم.</p>
<h4 id="_18">افزودن در بازه‌ها<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h4>
<p>بیا با ساده‌ترین شکل مسائل شروع کنیم: کوئری تغییر باید عدد <span class="arithmatex">$x$</span> رو به همه‌ی اعداد توی بازه‌ی <span class="arithmatex">$a[l \dots r]$</span> اضافه کنه.</p>
<p>کوئری دومی که قراره بهش جواب بدیم، خیلی ساده مقدار <span class="arithmatex">$a[i]$</span> رو می‌پرسه.</p>
<p>برای اینکه کوئری افزودن رو کارآمد کنیم، توی هر گره‌ی درخت بازه ها ذخیره می‌کنیم که چقدر باید به همه‌ی اعداد توی بازه‌ی مربوطه‌ش اضافه کنیم.</p>
<p>مثلاً، اگه کوئری "۳ رو به کل آرایه‌ی <span class="arithmatex">$a[0 \dots n-1]$</span> اضافه کن" بیاد، ما عدد ۳ رو توی ریشه‌ی درخت می‌ذاریم.</p>
<p>به طور کلی، باید این عدد رو توی چندین بازه بذاریم که یه افراز (partition) از بازه‌ی کوئری رو تشکیل می‌دن.</p>
<p>بنابراین نیازی نیست همه‌ی <span class="arithmatex">$O(n)$</span> تا مقدار رو تغییر بدیم، بلکه فقط <span class="arithmatex">$O(\log n)$</span> تا مقدار کافیه.</p>
<p>اگه الان یه کوئری بیاد که مقدار فعلی یه خونه‌ی خاص از آرایه رو بپرسه، کافیه توی درخت پایین بریم و همه‌ی مقادیری که توی مسیر پیدا می‌کنیم رو با هم جمع کنیم.</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">tl</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">);</span>
<span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">);</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">add</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">add</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">),</span><span class="w"> </span><span class="n">add</span><span class="p">);</span>
<span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">add</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">tm</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_19">انتساب در بازه‌ها<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<p>حالا فرض کن که کوئری تغییر می‌خواد هر عنصر از یه بازه‌ی مشخص <span class="arithmatex">$a[l \dots r]$</span> رو به یه مقدار <span class="arithmatex">$p$</span> اختصاص بده.</p>
<p>به عنوان کوئری دوم، باز هم خوندن مقدار آرایه‌ی <span class="arithmatex">$a[i]$</span> رو در نظر می‌گیریم.</p>
<p>برای انجام این کوئری تغییر روی یه بازه‌ی کامل، باید توی هر گره‌ی درخت بازه ها ذخیره کنیم که آیا بازه‌ی مربوط بهش به طور کامل با یه مقدار یکسان پوشونده شده یا نه.</p>
<p>این به ما اجازه می‌ده یه آپدیت "تنبل" (lazy) انجام بدیم:</p>
<p>به جای تغییر دادن همه‌ی بازه‌های توی درخت که بازه‌ی کوئری رو پوشش می‌دن، ما فقط بعضی‌ها رو تغییر می‌دیم و بقیه رو دست‌نخورده می‌ذاریم.</p>
<p>یه گره‌ی علامت‌گذاری شده به این معنیه که هر عنصر از بازه‌ی مربوط بهش به اون مقدار اختصاص داده شده، و در واقع کل زیردرختش هم باید فقط شامل همین مقدار باشه.</p>
<p>یه جورایی تنبلی می‌کنیم و نوشتن مقدار جدید رو برای همه‌ی اون گره‌ها به تعویق می‌ندازیم.</p>
<p>می‌تونیم این کار خسته‌کننده رو بعداً، اگه لازم شد، انجام بدیم.</p>
<p>پس بعد از اجرای کوئری تغییر، بعضی از بخش‌های درخت نامربوط می‌شن - بعضی از تغییرات توی اون انجام نشده باقی می‌مونن.</p>
<p>برای مثال اگه یه کوئری تغییر "اختصاص یه عدد به کل آرایه‌ی <span class="arithmatex">$a[0 \dots n-1]$</span>" اجرا بشه، توی درخت بازه ها فقط یه تغییر ایجاد می‌شه - عدد توی ریشه‌ی درخت قرار می‌گیره و این گره علامت‌گذاری می‌شه.</p>
<p>بازه‌های باقیمونده بدون تغییر باقی می‌مونن، اگرچه در واقع عدد باید توی کل درخت قرار بگیره.</p>
<p>حالا فرض کن که کوئری تغییر دوم می‌گه که نیمه‌ی اول آرایه <span class="arithmatex">$a[0 \dots n/2]$</span> باید با عدد دیگه‌ای جایگزین بشه.</p>
<p>برای پردازش این کوئری باید هر عنصر توی کل بچه‌ی چپ ریشه رو با اون عدد جایگزین کنیم.</p>
<p>اما قبل از اینکه این کار رو بکنیم، باید اول گره‌ی ریشه رو مرتب کنیم.</p>
<p>نکته‌ی ظریف اینجا اینه که نیمه‌ی راست آرایه هنوز باید مقدار کوئری اول رو داشته باشه، و در حال حاضر هیچ اطلاعاتی برای نیمه‌ی راست ذخیره نشده.</p>
<p>راه حل اینه که اطلاعات ریشه رو به بچه‌هاش منتقل (push) کنیم، یعنی اگه ریشه‌ی درخت با هر عددی جایگزین شده بود، اون وقت گره‌های بچه‌ی چپ و راست رو با این عدد جایگزین می‌کنیم و علامت ریشه رو حذف می‌کنیم.</p>
<p>بعد از اون، می‌تونیم بچه‌ی چپ رو با مقدار جدید جایگزین کنیم، بدون اینکه اطلاعات ضروری رو از دست بدیم.</p>
<p>خلاصه:</p>
<p>برای هر کوئری (یه کوئری تغییر یا خوندن) موقع پایین رفتن توی درخت، باید همیشه اطلاعات رو از گره‌ی فعلی به هر دو تا بچه‌ش منتقل کنیم.</p>
<p>می‌تونیم این رو اینطوری بفهمیم که وقتی توی درخت پایین می‌ریم، تغییرات تأخیری رو اعمال می‌کنیم، اما دقیقاً به اندازه‌ای که لازمه (تا پیچیدگی <span class="arithmatex">$O(\log n)$</span> رو خراب نکنیم).</p>
<p>برای پیاده‌سازی، باید یه تابع <code>push</code> بسازیم، که گره‌ی فعلی رو می‌گیره و اطلاعاتش رو به هر دو تا بچه‌ش منتقل می‌کنه.</p>
<p>ما این تابع رو اول توابع کوئری صدا می‌زنیم (اما از برگ‌ها صداش نمی‌زنیم، چون نیازی به انتقال اطلاعات از اونا به پایین‌تر نیست).</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">push</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">marked</span><span class="p">[</span><span class="n">v</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<span class="w">        </span><span class="n">marked</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">marked</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">marked</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">new_val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_val</span><span class="p">;</span>
<span class="w">        </span><span class="n">marked</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">push</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">),</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">push</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">tm</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>نکته: تابع <code>get</code> رو می‌شه به یه روش دیگه هم پیاده‌سازی کرد:</p>
<p>آپدیت‌های تأخیری رو انجام نده، بلکه اگه <code>marked[v]</code> درست بود، بلافاصله مقدار <code>t[v]</code> رو برگردون.</p>
<h4 id="_20">افزودن در بازه‌ها، کوئری بیشینه<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h4>
<p>حالا کوئری تغییر، اضافه کردن یه عدد به همه‌ی عناصر توی یه بازه‌ست، و کوئری خوندن، پیدا کردن بیشینه توی یه بازه‌ست.</p>
<p>بنابراین برای هر گره از درخت بازه ها، باید بیشینه‌ی زیربازه‌ی مربوطه رو ذخیره کنیم.</p>
<p>بخش جالبش اینه که چطوری این مقادیر رو موقع یه درخواست تغییر دوباره حساب کنیم.</p>
<p>برای این منظور، یه مقدار اضافی برای هر گره نگه می‌داریم.</p>
<p>توی این مقدار، مقادیر افزودنی‌ای که به گره‌های بچه منتقل نکردیم رو ذخیره می‌کنیم.</p>
<p>قبل از اینکه به یه گره‌ی بچه بریم، تابع <code>push</code> رو صدا می‌زنیم و مقدار رو به هر دو تا بچه منتقل می‌کنیم.</p>
<p>باید این کار رو هم توی تابع <code>update</code> و هم توی تابع <code>query</code> انجام بدیم.</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">tl</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">);</span>
<span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">);</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">push</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<span class="w">    </span><span class="n">lazy</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<span class="w">    </span><span class="n">lazy</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<span class="w">    </span><span class="n">lazy</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">addend</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">addend</span><span class="p">;</span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">addend</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">push</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">),</span><span class="w"> </span><span class="n">addend</span><span class="p">);</span>
<span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">addend</span><span class="p">);</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">INF</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<span class="w">    </span><span class="n">push</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">)),</span><span class="w"> </span>
<span class="w">               </span><span class="n">query</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_21"><a name="generalization-to-higher-dimensions"></a>تعمیم به ابعاد بالاتر<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<p>یه درخت بازه ها رو می‌شه خیلی طبیعی به ابعاد بالاتر تعمیم داد.</p>
<p>اگه توی حالت یک‌بعدی اندیس‌های آرایه رو به بازه‌هایی تقسیم می‌کنیم، توی حالت دوبعدی یه درخت بازه ها‌ی معمولی نسبت به اندیس‌های اول می‌سازیم، و برای هر بازه یه درخت بازه ها‌ی معمولی نسبت به اندیس‌های دوم می‌سازیم.</p>
<h4 id="_22">درخت بازه ها‌ی ساده‌ی دوبعدی<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h4>
<p>یه ماتریس <span class="arithmatex">$a[0 \dots n-1, 0 \dots m-1]$</span> داریم، و باید جمع (یا کمینه/بیشینه) رو توی یه زیرماتریس <span class="arithmatex">$a[x_1 \dots x_2, y_1 \dots y_2]$</span> پیدا کنیم، و همچنین تغییرات عناصر جداگانه‌ی ماتریس رو انجام بدیم (یعنی کوئری‌هایی از نوع <span class="arithmatex">$a[x][y] = p$</span>).</p>
<p>بنابراین یه درخت بازه ها‌ی دوبعدی می‌سازیم: اول درخت بازه ها با استفاده از مختصات اول (<span class="arithmatex">$x$</span>)، بعد دوم (<span class="arithmatex">$y$</span>).</p>
<p>برای اینکه فرآیند ساخت قابل فهم‌تر بشه، می‌تونی برای یه مدت فراموش کنی که ماتریس دوبعدی‌یه و فقط مختصات اول رو در نظر بگیری.</p>
<p>ما یه درخت بازه ها‌ی یک‌بعدی معمولی با استفاده از فقط مختصات اول می‌سازیم.</p>
<p>اما به جای ذخیره کردن یه عدد توی یه بازه، ما یه درخت بازه ها‌ی کامل رو ذخیره می‌کنیم:</p>
<p>یعنی توی این لحظه به یاد می‌آریم که یه مختصات دوم هم داریم؛ اما چون در این لحظه مختصات اول به یه بازه‌ی <span class="arithmatex">$[l \dots r]$</span> ثابت شده، ما در واقع با یه نوار <span class="arithmatex">$a[l \dots r, 0 \dots m-1]$</span> کار می‌کنیم و برای اون یه درخت بازه ها می‌سازیم.</p>
<p>اینجا پیاده‌سازی ساخت یه درخت بازه ها‌ی دوبعدی رو می‌بینی.</p>
<p>این در واقع دو تا بلوک جداگانه رو نشون می‌ده:</p>
<p>ساخت یه درخت بازه ها در امتداد مختصات <span class="arithmatex">$x$</span> (<code>build_x</code>)، و مختصات <span class="arithmatex">$y$</span> (<code>build_y</code>).</p>
<p>برای گره‌های برگ توی <code>build_y</code> باید دو تا حالت رو جدا کنیم:</p>
<p>وقتی بازه‌ی فعلی مختصات اول <span class="arithmatex">$[tlx \dots trx]$</span> طولش ۱ باشه، و وقتی طولش بیشتر از یک باشه. توی حالت اول، ما فقط مقدار مربوطه رو از ماتریس می‌گیریم، و توی حالت دوم می‌تونیم مقادیر دو تا درخت بازه ها از بچه‌ی چپ و راست توی مختصات <span class="arithmatex">$x$</span> رو با هم ترکیب کنیم.</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">build_y</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">vy</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ly</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ly</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lx</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span>
<span class="w">            </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="n">vy</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">lx</span><span class="p">][</span><span class="n">ly</span><span class="p">];</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="n">vy</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="o">*</span><span class="mi">2</span><span class="p">][</span><span class="n">vy</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">vy</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ly</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ry</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">build_y</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="n">vy</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">ly</span><span class="p">,</span><span class="w"> </span><span class="n">my</span><span class="p">);</span>
<span class="w">        </span><span class="n">build_y</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="n">vy</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">my</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ry</span><span class="p">);</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="n">vy</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="n">vy</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="n">vy</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">build_x</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lx</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">mx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">build_x</span><span class="p">(</span><span class="n">vx</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="n">mx</span><span class="p">);</span>
<span class="w">        </span><span class="n">build_x</span><span class="p">(</span><span class="n">vx</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">build_y</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="mi">-1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>چنین درخت بازه ها‌ای هنوز از مقدار حافظه‌ی خطی استفاده می‌کنه، اما با یه ثابت بزرگتر: <span class="arithmatex">$16 n m$</span>.</p>
<p>واضحه که تابع <code>build_x</code> که توضیح دادیم هم توی زمان خطی کار می‌کنه.</p>
<p>حالا بیا به پردازش کوئری‌ها بپردازیم. ما به کوئری دوبعدی با همون اصل جواب می‌دیم:</p>
<p>اول کوئری رو بر روی مختصات اول می‌شکنیم، و بعد برای هر گره‌ای که بهش می‌رسیم، درخت بازه ها‌ی مربوطه از مختصات دوم رو صدا می‌زنیم.</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">sum_y</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">vy</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tly</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">try_</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ly</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ly</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ry</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ly</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tly</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">try_</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ry</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="n">vy</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tmy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tly</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">try_</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sum_y</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="n">vy</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tly</span><span class="p">,</span><span class="w"> </span><span class="n">tmy</span><span class="p">,</span><span class="w"> </span><span class="n">ly</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">ry</span><span class="p">,</span><span class="w"> </span><span class="n">tmy</span><span class="p">))</span>
<span class="w">         </span><span class="o">+</span><span class="w"> </span><span class="n">sum_y</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="n">vy</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tmy</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">try_</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">ly</span><span class="p">,</span><span class="w"> </span><span class="n">tmy</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">sum_x</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tlx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">trx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ly</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lx</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lx</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tlx</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">trx</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sum_y</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="n">ly</span><span class="p">,</span><span class="w"> </span><span class="n">ry</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tmx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tlx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">trx</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sum_x</span><span class="p">(</span><span class="n">vx</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tlx</span><span class="p">,</span><span class="w"> </span><span class="n">tmx</span><span class="p">,</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="n">tmx</span><span class="p">),</span><span class="w"> </span><span class="n">ly</span><span class="p">,</span><span class="w"> </span><span class="n">ry</span><span class="p">)</span>
<span class="w">         </span><span class="o">+</span><span class="w"> </span><span class="n">sum_x</span><span class="p">(</span><span class="n">vx</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tmx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">trx</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="n">tmx</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="n">ly</span><span class="p">,</span><span class="w"> </span><span class="n">ry</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>این تابع توی زمان <span class="arithmatex">$O(\log n \log m)$</span> کار می‌کنه، چون اول توی درخت در مختصات اول پایین می‌ره، و برای هر گره‌ی پیمایش شده توی اون درخت، یه کوئری توی درخت بازه ها‌ی مربوطه در امتداد مختصات دوم انجام می‌ده.</p>
<p>در نهایت کوئری تغییر رو در نظر می‌گیریم.</p>
<p>می‌خوایم یاد بگیریم چطوری درخت بازه ها رو مطابق با تغییر در مقدار یه عنصر <span class="arithmatex">$a[x][y] = p$</span> تغییر بدیم.</p>
<p>واضحه که تغییرات فقط توی اون گره‌های درخت بازه ها‌ی اول که مختصات <span class="arithmatex">$x$</span> رو پوشش می‌دن اتفاق می‌افته (که <span class="arithmatex">$O(\log n)$</span> تا هستن)، و برای درخت‌های بازه‌ی مربوط به اونا، تغییرات فقط توی اون گره‌هایی رخ می‌ده که مختصات <span class="arithmatex">$y$</span> رو پوشش می‌دن (که <span class="arithmatex">$O(\log m)$</span> تا هستن).</p>
<p>بنابراین پیاده‌سازی تفاوت چندانی با حالت یک‌بعدی نخواهد داشت، فقط الان اول در مختصات اول پایین می‌ریم، و بعد در مختصات دوم.</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">update_y</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">vy</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ly</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ry</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">new_val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ly</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lx</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span>
<span class="w">            </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="n">vy</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_val</span><span class="p">;</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="n">vy</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="o">*</span><span class="mi">2</span><span class="p">][</span><span class="n">vy</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">vy</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ly</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ry</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">my</span><span class="p">)</span>
<span class="w">            </span><span class="n">update_y</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="n">vy</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">ly</span><span class="p">,</span><span class="w"> </span><span class="n">my</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">update_y</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="n">vy</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">my</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ry</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">        </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="n">vy</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="n">vy</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="n">vy</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update_x</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">new_val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lx</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">mx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">mx</span><span class="p">)</span>
<span class="w">            </span><span class="n">update_x</span><span class="p">(</span><span class="n">vx</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="n">mx</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">update_x</span><span class="p">(</span><span class="n">vx</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">update_y</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="n">lx</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_23">فشرده‌سازی درخت بازه ها دوبعدی<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h4>
<p>فرض کن مسئله اینطوریه: <span class="arithmatex">$n$</span> تا نقطه توی صفحه با مختصاتشون <span class="arithmatex">$(x_i, y_i)$</span> داده شدن و کوئری‌هایی از نوع "تعداد نقاطی که توی مستطیل <span class="arithmatex">$((x_1, y_1), (x_2, y_2))$</span> قرار دارن رو بشمار" وجود داره.</p>
<p>واضحه که توی همچین مسئله‌ای، ساختن یه درخت بازه ها‌ی دوبعدی با <span class="arithmatex">$O(n^2)$</span> عنصر به طور غیر منطقی پرهزینه‌ست.</p>
<p>بیشتر این حافظه هدر می‌ره، چون هر نقطه فقط می‌تونه توی <span class="arithmatex">$O(\log n)$</span> بازه از درخت در امتداد مختصات اول قرار بگیره، و بنابراین اندازه‌ی "مفید" کل همه‌ی بازه‌های درخت در مختصات دوم <span class="arithmatex">$O(n \log n)$</span>ئه.</p>
<p>بنابراین اینطوری عمل می‌کنیم:</p>
<p>توی هر گره از درخت بازه ها نسبت به مختصات اول، یه درخت بازه ها‌ی ساخته شده فقط با اون مختصات دومی که توی بازه‌ی فعلی مختصات اول وجود دارن، ذخیره می‌کنیم.</p>
<p>به عبارت دیگه، موقع ساختن یه درخت بازه ها داخل یه گره با اندیس <span class="arithmatex">$vx$</span> و مرزهای <span class="arithmatex">$tlx$</span> و <span class="arithmatex">$trx$</span>، ما فقط اون نقاطی رو در نظر می‌گیریم که توی این بازه‌ی <span class="arithmatex">$x \in [tlx, trx]$</span> قرار می‌گیرن، و یه درخت بازه ها فقط با استفاده از اونا می‌سازیم.</p>
<p>اینطوری به این نتیجه می‌رسیم که هر درخت بازه ها در مختصات دوم دقیقاً به اندازه‌ای حافظه اشغال خواهد کرد که باید.</p>
<p>در نتیجه، کل حافظه به <span class="arithmatex">$O(n \log n)$</span> کاهش پیدا می‌کنه.</p>
<p>ما هنوز می‌تونیم به کوئری‌ها توی زمان <span class="arithmatex">$O(\log^2 n)$</span> جواب بدیم، فقط باید یه جستجوی دودویی در مختصات دوم انجام بدیم، اما این پیچیدگی رو بدتر نخواهد کرد.</p>
<p>اما کوئری‌های تغییر با این ساختار غیرممکن خواهند بود:</p>
<p>در واقع اگه یه نقطه‌ی جدید ظاهر بشه، ما باید یه عنصر جدید رو وسط یه درخت بازه ها در امتداد مختصات دوم اضافه کنیم، که به طور موثر قابل انجام نیست.</p>
<p>در پایان اشاره می‌کنیم که درخت بازه ها‌ی دوبعدی که به روش توصیف شده فشرده شده، عملاً معادل تغییر درخت بازه ها‌ی یک‌بعدی می‌شه (بخش <a href="segment_tree.html#saving-the-entire-subarrays-in-each-vertex">ذخیره کل زیرآرایه‌ها در هر رأس</a> رو ببین).</p>
<p>به طور خاص، درخت بازه ها‌ی دوبعدی فقط یه مورد خاص از ذخیره کردن یه زیرآرایه توی هر گره از درخته.</p>
<p>از این رو، اگه مجبور شدی یه درخت بازه ها‌ی دوبعدی رو به خاطر عدم امکان اجرای یه کوئری ول کنی، منطقیه که سعی کنی درخت بازه ها‌ی تودرتو رو با یه ساختار داده‌ی قدرتمندتر، مثلاً یه درخت کارتزین، جایگزین کنی.</p>
<h3 id="persistent">حفظ تاریخچه مقادیر (درخت بازه ها پایدار یا Persistent)<a class="headerlink" href="#persistent" title="Permanent link">&para;</a></h3>
<p>یه ساختمان داده‌ی پایدار (Persistent)، ساختاریه که حالت قبلی خودش رو برای هر تغییر به یاد می‌آره.</p>
<p>این کار به ما اجازه می‌ده به هر نسخه‌ای از این ساختمان داده که دوست داریم دسترسی پیدا کنیم و روی اون کوئری اجرا کنیم.</p>
<p>درخت بازه ها ساختمانی داده‌ایه که می‌تونه به طور بهینه (هم از نظر زمان و هم از نظر مصرف حافظه) به یه ساختمان داده‌ی پایدار تبدیل بشه.</p>
<p>ما می‌خوایم از کپی کردن کل درخت قبل از هر تغییر اجتناب کنیم، و نمی‌خوایم رفتار زمانی <span class="arithmatex">$O(\log n)$</span> رو برای پاسخ به کوئری‌های بازه‌ای از دست بدیم.</p>
<p>در واقع، هر درخواست تغییر توی درخت بازه ها، منجر به تغییر توی داده‌های فقط <span class="arithmatex">$O(\log n)$</span> تا گره در طول مسیر از ریشه می‌شه.</p>
<p>بنابراین اگه درخت بازه ها رو با استفاده از اشاره‌گرها ذخیره کنیم (یعنی یه گره اشاره‌گرهایی به گره‌های بچه‌ی چپ و راست رو ذخیره کنه)، اون وقت موقع انجام کوئری تغییر، به سادگی باید گره‌های جدیدی ایجاد کنیم به جای اینکه گره‌های موجود رو تغییر بدیم.</p>
<p>گره‌هایی که تحت تأثیر کوئری تغییر قرار نمی‌گیرن، هنوز هم می‌تونن با اشاره کردن اشاره‌گرها به گره‌های قدیمی استفاده بشن.</p>
<p>بنابراین برای یه کوئری تغییر <span class="arithmatex">$O(\log n)$</span> گره‌ی جدید ایجاد می‌شه، از جمله یه گره‌ی ریشه‌ی جدید برای درخت بازه ها، و کل نسخه‌ی قبلی درخت با ریشه‌ی قدیمی بدون تغییر باقی می‌مونه.</p>
<p>بیا یه مثال پیاده‌سازی برای ساده‌ترین درخت بازه ها ارائه بدیم: وقتی فقط یه کوئری جمع و کوئری‌های تغییر عناصر تکی وجود داره.</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">Vertex</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">*</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">r</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>

<span class="w">    </span><span class="n">Vertex</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">l</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="n">Vertex</span><span class="p">(</span><span class="n">Vertex</span><span class="w"> </span><span class="o">*</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">Vertex</span><span class="w"> </span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">l</span><span class="p">(</span><span class="n">l</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">(</span><span class="n">r</span><span class="p">),</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">l</span><span class="o">-&gt;</span><span class="n">sum</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">r</span><span class="o">-&gt;</span><span class="n">sum</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="n">Vertex</span><span class="o">*</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vertex</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">tl</span><span class="p">]);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vertex</span><span class="p">(</span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">),</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">get_sum</span><span class="p">(</span><span class="n">Vertex</span><span class="o">*</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">v</span><span class="o">-&gt;</span><span class="n">sum</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">get_sum</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">))</span>
<span class="w">         </span><span class="o">+</span><span class="w"> </span><span class="n">get_sum</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">Vertex</span><span class="o">*</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">Vertex</span><span class="o">*</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">new_val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vertex</span><span class="p">(</span><span class="n">new_val</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">tm</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vertex</span><span class="p">(</span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vertex</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">new_val</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<p>برای هر تغییر توی درخت بازه ها، یه ریشه‌ی جدید دریافت خواهیم کرد.</p>
<p>برای پرش سریع بین دو نسخه‌ی مختلف از درخت بازه ها، باید این ریشه‌ها رو توی یه آرایه ذخیره کنیم.</p>
<p>برای استفاده از یه نسخه‌ی خاص از درخت بازه ها، به سادگی کوئری رو با استفاده از ریشه‌ی مناسب صدا می‌زنیم.</p>
<p>با روشی که بالا توضیح دادیم، تقریباً هر درخت بازه ها‌ای رو می‌شه به یه ساختمان داده‌ی پایدار تبدیل کرد.</p>
<h4 id="k-">پیدا کردن <span class="arithmatex">$k$</span>-امین کوچکترین عدد در یک بازه<a class="headerlink" href="#k-" title="Permanent link">&para;</a></h4>
<p>این بار باید به کوئری‌هایی از نوع "k-امین کوچکترین عنصر توی بازه‌ی <span class="arithmatex">$a[l \dots r]$</span> چیه؟" جواب بدیم.</p>
<p>این کوئری رو می‌شه با استفاده از جستجوی دودویی و یه درخت مرتب‌سازی ادغامی جواب داد، اما پیچیدگی زمانی برای یه کوئری واحد <span class="arithmatex">$O(\log^3 n)$</span> خواهد بود.</p>
<p>ما همین کار رو با استفاده از یه درخت بازه ها‌ی پایدار توی <span class="arithmatex">$O(\log n)$</span> انجام می‌دیم.</p>
<p>اول یه راه حل برای یه مسئله‌ی ساده‌تر رو بحث می‌کنیم:</p>
<p>ما فقط آرایه‌هایی رو در نظر می‌گیریم که عناصرشون توی محدوده‌ی <span class="arithmatex">$0 \le a[i] \lt n$</span> قرار دارن.</p>
<p>و ما فقط می‌خوایم <span class="arithmatex">$k$</span>-امین کوچکترین عنصر رو توی یه پیشوند (prefix) از آرایه‌ی <span class="arithmatex">$a$</span> پیدا کنیم.</p>
<p>گسترش ایده‌هایی که بعداً توسعه می‌دیم برای آرایه‌های بدون محدودیت و کوئری‌های بازه‌ای بدون محدودیت خیلی آسون خواهد بود.</p>
<p>یادت باشه که ما از اندیس‌گذاری مبتنی بر ۱ برای <span class="arithmatex">$a$</span> استفاده خواهیم کرد.</p>
<p>ما از یه درخت بازه ها استفاده خواهیم کرد که تمام اعداد ظاهر شده رو می‌شماره، یعنی توی درخت بازه ها‌ی ما هیستوگرام آرایه رو ذخیره خواهیم کرد.</p>
<p>بنابراین گره‌های برگ ذخیره می‌کنن که مقادیر <span class="arithmatex">$0$</span>، <span class="arithmatex">$1$</span>، <span class="arithmatex">$\dots$</span>، <span class="arithmatex">$n-1$</span> چند بار توی آرایه ظاهر می‌شن، و گره‌های دیگه ذخیره می‌کنن که چند تا عدد توی یه بازه‌ی مشخص در آرایه وجود دارن.</p>
<p>به عبارت دیگه ما یه درخت بازه ها‌ی معمولی با کوئری‌های جمع روی هیستوگرام آرایه ایجاد می‌کنیم.</p>
<p>اما به جای ایجاد همه‌ی <span class="arithmatex">$n$</span> تا درخت بازه ها برای هر پیشوند ممکن، ما یه درخت پایدار ایجاد خواهیم کرد که همون اطلاعات رو در بر خواهد داشت.</p>
<p>ما با یه درخت بازه ها‌ی خالی (همه‌ی شمارش‌ها <span class="arithmatex">$0$</span> خواهند بود) که توسط <code>root_0</code> بهش اشاره می‌شه، شروع می‌کنیم و عناصر <span class="arithmatex">$a[1]$</span>، <span class="arithmatex">$a[2]$</span>، <span class="arithmatex">$\dots$</span>، <span class="arithmatex">$a[n]$</span> رو یکی یکی اضافه می‌کنیم.</p>
<p>برای هر تغییر، یه ریشه‌ی جدید دریافت خواهیم کرد، بیایید <code>root_i</code> رو ریشه‌ی درخت بازه ها بعد از درج <span class="arithmatex">$i$</span> عنصر اول آرایه‌ی <span class="arithmatex">$a$</span> بنامیم.</p>
<p>درخت بازه ها با ریشه‌ی <code>root_i</code> حاوی هیستوگرام پیشوند <span class="arithmatex">$a[1 \dots i]$</span> خواهد بود.</p>
<p>با استفاده از این درخت بازه ها می‌تونیم توی زمان <span class="arithmatex">$O(\log n)$</span> موقعیت <span class="arithmatex">$k$</span>-امین عنصر رو با استفاده از همون تکنیک مورد بحث در <a href="segment_tree.html#counting-zero-search-kth">شمارش تعداد صفرها، جستجو برای <span class="arithmatex">$k$</span>-امین صفر</a> پیدا کنیم.</p>
<p>حالا بیا به نسخه‌ی بدون محدودیت مسئله بپردازیم.</p>
<p>اول برای محدودیت روی کوئری‌ها:</p>
<p>به جای انجام این کوئری‌ها فقط روی یه پیشوند از <span class="arithmatex">$a$</span>، می‌خوایم از هر بازه‌ی دلخواه <span class="arithmatex">$a[l \dots r]$</span> استفاده کنیم.</p>
<p>اینجا ما به یه درخت بازه ها نیاز داریم که هیستوگرام عناصر توی بازه‌ی <span class="arithmatex">$a[l \dots r]$</span> رو نشون بده.</p>
<p>خیلی راحت می‌شه دید که چنین درخت بازه ها‌ای فقط تفاوت بین درخت بازه ها با ریشه‌ی <code>root_r</code> و درخت بازه ها با ریشه‌ی <code>root_{l-1}</code>ئه، یعنی هر گره توی درخت بازه ها‌ی <span class="arithmatex">$[l \dots r]$</span> رو می‌شه با گره‌ی درخت <code>root_r</code> منهای گره‌ی درخت <code>root_{l-1}</code> حساب کرد.</p>
<p>توی پیاده‌سازی تابع <code>find_kth</code> این رو می‌شه با پاس دادن دو تا اشاره‌گر گره و محاسبه‌ی شمارش/مجموع بازه‌ی فعلی به عنوان تفاوت دو تا شمارش/مجموع گره‌ها مدیریت کرد.</p>
<p>اینجا توابع اصلاح شده‌ی <code>build</code>، <code>update</code> و <code>find_kth</code> رو می‌بینی.</p>
<div class="highlight"><pre><span></span><code><span class="n">Vertex</span><span class="o">*</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vertex</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vertex</span><span class="p">(</span><span class="n">build</span><span class="p">(</span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">),</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">Vertex</span><span class="o">*</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">Vertex</span><span class="o">*</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vertex</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">sum</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">tm</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vertex</span><span class="p">(</span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vertex</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">find_kth</span><span class="p">(</span><span class="n">Vertex</span><span class="o">*</span><span class="w"> </span><span class="n">vl</span><span class="p">,</span><span class="w"> </span><span class="n">Vertex</span><span class="w"> </span><span class="o">*</span><span class="n">vr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">tl</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">left_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vr</span><span class="o">-&gt;</span><span class="n">l</span><span class="o">-&gt;</span><span class="n">sum</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">vl</span><span class="o">-&gt;</span><span class="n">l</span><span class="o">-&gt;</span><span class="n">sum</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">left_count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">find_kth</span><span class="p">(</span><span class="n">vl</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">vr</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">find_kth</span><span class="p">(</span><span class="n">vl</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">vr</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">-</span><span class="n">left_count</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>همونطور که قبلاً نوشتیم، باید ریشه‌ی درخت بازه ها‌ی اولیه و همچنین همه‌ی ریشه‌ها بعد از هر آپدیت رو ذخیره کنیم.</p>
<p>اینجا کد ساخت یه درخت بازه ها‌ی پایدار روی یه وکتور <code>a</code> با عناصر توی بازه‌ی <code>[0, MAX_VALUE]</code> رو می‌بینی.</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MAX_VALUE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">roots</span><span class="p">;</span>
<span class="n">roots</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">build</span><span class="p">(</span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">));</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">roots</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">update</span><span class="p">(</span><span class="n">roots</span><span class="p">.</span><span class="n">back</span><span class="p">(),</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
<span class="p">}</span>

<span class="c1">// پیدا کردن پنجمین کوچکترین عدد از زیرآرایه‌ی [a[2], a[3], ..., a[19]]</span>
<span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_kth</span><span class="p">(</span><span class="n">roots</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">roots</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
</code></pre></div>
<p>حالا به محدودیت‌ها روی عناصر آرایه:</p>
<p>ما در واقع می‌تونیم هر آرایه‌ای رو با فشرده‌سازی اندیس (Coordinate Compression) به چنین آرایه‌ای تبدیل کنیم.</p>
<p>کوچکترین عنصر توی آرایه مقدار 0، دومین کوچکترین مقدار 1 و به همین ترتیب بهش اختصاص داده می‌شه.</p>
<p>تولید جداول جستجو (مثلاً با استفاده از <code>map</code>) که یه مقدار رو به اندیسش و بالعکس توی زمان <span class="arithmatex">$O(\log n)$</span> تبدیل می‌کنن، آسونه.</p>
<h3 id="_24">درخت بازه ها پویا<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>(به این دلیل اینطوری نامیده می‌شه که شکلش پویاست و گره‌ها معمولاً به صورت پویا تخصیص داده می‌شن.</p>
<p>همچنین به عنوان <em>درخت بازه ها‌ی ضمنی</em> (Implicit Segment Tree) یا <em>درخت بازه ها‌ی پراکنده</em> (Sparse Segment Tree) هم شناخته می‌شه.)</p>
<p>قبلاً، مواردی رو در نظر گرفتیم که توانایی ساخت درخت بازه ها‌ی اصلی رو داشتیم. اما چه باید کرد اگه اندازه‌ی اصلی با یه عنصر پیش‌فرض پر شده باشه، اما اندازه‌ش اجازه نده که از قبل به طور کامل اون رو بسازیم؟</p>
<p>ما می‌تونیم این مشکل رو با ایجاد یه درخت بازه ها به صورت تنبل (افزایشی) حل کنیم. در ابتدا، ما فقط ریشه رو ایجاد خواهیم کرد و گره‌های دیگه رو فقط زمانی که بهشون نیاز داریم ایجاد خواهیم کرد.</p>
<p>در این حالت، از پیاده‌سازی بر روی اشاره‌گرها استفاده خواهیم کرد (قبل از رفتن به بچه‌های گره، بررسی کنید که آیا ایجاد شده‌اند و اگر نه، آنها را ایجاد کنید).</p>
<p>هر کوئری هنوز فقط پیچیدگی <span class="arithmatex">$O(\log n)$</span> را دارد، که برای اکثر موارد استفاده به اندازه کافی کوچک است (مثلاً <span class="arithmatex">$\log_2 10^9 \approx 30$</span>).</p>
<p>در این پیاده‌سازی ما دو پرس‌وجو داریم، اضافه کردن یک مقدار به یک موقعیت (در ابتدا تمام مقادیر <span class="arithmatex">$0$</span> هستند)، و محاسبه مجموع تمام مقادیر در یک بازه.</p>
<p><code>Vertex(0, n)</code> رأس ریشه درخت ضمنی خواهد بود.</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">Vertex</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="o">*</span><span class="n">left_child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">right_child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>

<span class="w">    </span><span class="n">Vertex</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">lb</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lb</span><span class="p">;</span>
<span class="w">        </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rb</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">extend</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">left_child</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">right</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">left</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">right</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">            </span><span class="n">left_child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vertex</span><span class="p">(</span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="w">            </span><span class="n">right_child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vertex</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">extend</span><span class="p">();</span>
<span class="w">        </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">left_child</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">left_child</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">)</span>
<span class="w">                </span><span class="n">left_child</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="n">right_child</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">get_sum</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">lq</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rq</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lq</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">rq</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">lq</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">right</span><span class="p">,</span><span class="w"> </span><span class="n">rq</span><span class="p">))</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">extend</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">left_child</span><span class="o">-&gt;</span><span class="n">get_sum</span><span class="p">(</span><span class="n">lq</span><span class="p">,</span><span class="w"> </span><span class="n">rq</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">right_child</span><span class="o">-&gt;</span><span class="n">get_sum</span><span class="p">(</span><span class="n">lq</span><span class="p">,</span><span class="w"> </span><span class="n">rq</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>بدیهی است که این ایده را می‌توان به روش‌های مختلفی گسترش داد. به عنوان مثال، با افزودن پشتیبانی از به‌روزرسانی‌های بازه‌ای از طریق انتشار با تأخیر.</p>
<h2 id="_25">مسائل تمرینی<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="http://www.spoj.com/problems/KQUERY/">SPOJ - KQUERY</a> [درخت بازه ها‌ی پایدار / درخت مرتب‌سازی ادغامی]</li>
<li><a href="https://codeforces.com/problemset/problem/339/D">Codeforces - Xenia and Bit Operations</a></li>
<li><a href="https://uva.onlinejudge.org/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;problem=2397">UVA 11402 - Ahoy, Pirates!</a></li>
<li><a href="http://www.spoj.com/problems/GSS3/">SPOJ - GSS3</a></li>
<li><a href="https://codeforces.com/problemset/problem/1234/D">Codeforces - Distinct Characters Queries</a></li>
<li><a href="https://codeforces.com/contest/356/problem/A">Codeforces - Knight Tournament</a> [برای مبتدیان]</li>
<li><a href="https://codeforces.com/contest/474/problem/F">Codeforces - Ant colony</a></li>
<li><a href="https://codeforces.com/contest/515/problem/E">Codeforces - Drazil and Park</a></li>
<li><a href="https://codeforces.com/problemset/problem/52/C">Codeforces - Circular RMQ</a></li>
<li><a href="https://codeforces.com/contest/121/problem/E">Codeforces - Lucky Array</a></li>
<li><a href="https://codeforces.com/contest/438/problem/D">Codeforces - The Child and Sequence</a></li>
<li><a href="https://codeforces.com/contest/446/problem/C">Codeforces - DZY Loves Fibonacci Numbers</a> [انتشار با تأخیر]</li>
<li><a href="https://codeforces.com/problemset/problem/610/E">Codeforces - Alphabet Permutations</a></li>
<li><a href="https://codeforces.com/problemset/problem/895/E">Codeforces - Eyes Closed</a></li>
<li><a href="https://codeforces.com/problemset/problem/580/E">Codeforces - Kefa and Watch</a></li>
<li><a href="https://codeforces.com/problemset/problem/558/E">Codeforces - A Simple Task</a></li>
<li><a href="https://codeforces.com/problemset/problem/920/F">Codeforces - SUM and REPLACE</a></li>
<li><a href="https://codeforces.com/problemset/problem/242/E">Codeforces - XOR on Segment</a> [انتشار با تأخیر]</li>
<li><a href="https://codeforces.com/problemset/problem/1114/F">Codeforces - Please, another Queries on Array?</a> [انتشار با تأخیر]</li>
<li><a href="https://oj.uz/problem/view/COCI17_deda">COCI - Deda</a> [آخرین عنصر کوچکتر یا مساوی x / جستجوی دودویی]</li>
<li><a href="https://codeforces.com/problemset/problem/869/E">Codeforces - The Untended Antiquity</a> [دوبعدی]</li>
<li><a href="https://cses.fi/problemset/task/1143">CSES - Hotel Queries</a></li>
<li><a href="https://cses.fi/problemset/task/1736">CSES - Polynomial Queries</a></li>
<li><a href="https://cses.fi/problemset/task/1735">CSES - Range Updates and Sums</a></li>
</ul>

<ul class="metadata page-metadata" data-bi-name="page info" lang="en-us" dir="ltr">
  <span class="contributors-text">Contributors:</span>
  <ul class="contributors" data-bi-name="contributors"><li><a href="https://github.com/2077DevWave" title="2077DevWave" data-bi-name="contributorprofile" target="_blank">2077DevWave</a> (49.24%)</li><li><a href="https://github.com/jakobkogler" title="jakobkogler" data-bi-name="contributorprofile" target="_blank">jakobkogler</a> (39.69%)</li><li><a href="https://github.com/dasfex" title="dasfex" data-bi-name="contributorprofile" target="_blank">dasfex</a> (3.37%)</li><li><a href="https://github.com/arjan-bal" title="arjan-bal" data-bi-name="contributorprofile" target="_blank">arjan-bal</a> (2.89%)</li><li><a href="https://github.com/masterchef2209" title="masterchef2209" data-bi-name="contributorprofile" target="_blank">masterchef2209</a> (1.03%)</li><li><a href="https://github.com/akoutian" title="akoutian" data-bi-name="contributorprofile" target="_blank">akoutian</a> (0.76%)</li><li><a href="https://github.com/L1nkus" title="L1nkus" data-bi-name="contributorprofile" target="_blank">L1nkus</a> (0.75%)</li><li><a href="https://github.com/tpoppo" title="tpoppo" data-bi-name="contributorprofile" target="_blank">tpoppo</a> (0.62%)</li><li><a href="https://github.com/GaurangTandon" title="GaurangTandon" data-bi-name="contributorprofile" target="_blank">GaurangTandon</a> (0.48%)</li><li><a href="https://github.com/mhayter" title="mhayter" data-bi-name="contributorprofile" target="_blank">mhayter</a> (0.34%)</li><li><a href="https://github.com/adamant-pwn" title="adamant-pwn" data-bi-name="contributorprofile" target="_blank">adamant-pwn</a> (0.34%)</li><li><a href="https://github.com/zyrch" title="zyrch" data-bi-name="contributorprofile" target="_blank">zyrch</a> (0.14%)</li><li><a href="https://github.com/wikku" title="wikku" data-bi-name="contributorprofile" target="_blank">wikku</a> (0.07%)</li><li><a href="https://github.com/DevChoganwala" title="DevChoganwala" data-bi-name="contributorprofile" target="_blank">DevChoganwala</a> (0.07%)</li><li><a href="https://github.com/jxu" title="jxu" data-bi-name="contributorprofile" target="_blank">jxu</a> (0.07%)</li><li><a href="https://github.com/aryamanjain-scifin" title="aryamanjain-scifin" data-bi-name="contributorprofile" target="_blank">aryamanjain-scifin</a> (0.07%)</li><li><a href="https://github.com/prashantkn94" title="prashantkn94" data-bi-name="contributorprofile" target="_blank">prashantkn94</a> (0.07%)</li></ul>
</ul>
                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      

<footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Text is available under the <a href="https://github.com/2077DevWave/cp-algorithms-fa/blob/main/LICENSE">Creative Commons Attribution Share Alike 4.0 International</a> License<br/>Copyright &copy; 2014 - 2025 by <a href="https://github.com/2077DevWave/cp-algorithms-fa/graphs/contributors">cp-algorithms contributors</a>
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
<div class="md-social">
  
</div>
    </div>
  </div>
</footer>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["toc.integrate", "search.suggest", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u06a9\u067e\u06cc \u0634\u062f", "clipboard.copy": "\u06a9\u067e\u06cc \u06a9\u0631\u062f\u0646", "search.result.more.one": "1 \u0645\u0648\u0631\u062f \u062f\u06cc\u06af\u0631 \u062f\u0631 \u0627\u06cc\u0646 \u0635\u0641\u062d\u0647", "search.result.more.other": "# \u0645\u0648\u0631\u062f \u062f\u06cc\u06af\u0631 \u062f\u0631 \u0627\u06cc\u0646 \u0635\u0641\u062d\u0647", "search.result.none": "\u0633\u0646\u062f\u06cc \u06cc\u0627\u0641\u062a \u0646\u0634\u062f", "search.result.one": "1 \u0633\u0646\u062f \u06cc\u0627\u0641\u062a \u0634\u062f", "search.result.other": "# \u0633\u0646\u062f \u06cc\u0627\u0641\u062a \u0634\u062f", "search.result.placeholder": "\u0628\u0631\u0627\u06cc \u0634\u0631\u0648\u0639 \u062c\u0633\u062a\u062c\u0648 \u062a\u0627\u06cc\u067e \u06a9\u0646\u06cc\u062f", "search.result.term.missing": "\u0645\u0648\u062c\u0648\u062f \u0646\u06cc\u0633\u062a", "select.version": "\u0627\u0646\u062a\u062e\u0627\u0628 \u0648\u06cc\u0631\u0627\u06cc\u0634"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../javascript/google.js"></script>
      
        <script src="../javascript/config.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>